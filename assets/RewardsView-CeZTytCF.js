import{aA as f,bf as j,r as c,j as e,C as h,bg as m,aF as v,aE as N}from"./index-DkVHath_.js";import{S as w}from"./star-C7zlGHyC.js";import{F as b}from"./flame-CI-j9JJ8.js";import{A as y}from"./activity-BPTn9Mz4.js";import{T as P}from"./trending-up-DQ6s5-C7.js";import{V as T}from"./ViewLayout-ya6HA0TA.js";const A=()=>{const{user:s}=f(),t=j(),i=c.useMemo(()=>{if(!t.progress)return{level:1,currentXp:0,xpToNextLevel:100,progressPercent:0,totalPoints:0,streak:0};const{currentLevel:x,totalXp:u,xpForNextLevel:p,currentPoints:r,currentTaskStreak:l}=t.progress,n=t.getProgressPercentage();return{level:x,currentXp:u,xpToNextLevel:p,progressPercent:n,totalPoints:r,streak:l}},[t.progress,t.getProgressPercentage]),o=t.loading;return{data:{progress:t.progress,progressStats:i,userId:s==null?void 0:s.id,levelUpAnimation:t.levelUpAnimation},state:{loading:o,isAuthenticated:!!s,hasProgress:!!t.progress},actions:{reloadProgress:t.reloadProgress}}},k=({progress:s,progressPercentage:t})=>s?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{className:"p-6 bg-gradient-to-br from-reward-light to-white border-reward/20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-6 h-6 text-reward-dark"}),e.jsxs("h3",{className:"text-xl font-bold text-reward-foreground",children:["Niveau ",s.currentLevel]})]}),e.jsxs("span",{className:"text-sm font-medium text-reward-foreground",children:[s.totalXp," / ",s.xpForNextLevel," XP"]})]}),e.jsx("div",{className:"w-full bg-reward/10 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-reward-dark to-reward transition-all duration-500 ease-out",style:{width:`${t}%`}})}),e.jsxs("p",{className:"text-sm text-reward-foreground/70",children:[Math.ceil(s.xpForNextLevel-s.totalXp)," XP jusqu'au niveau ",s.currentLevel+1]})]})}),e.jsx(h,{className:"p-6 bg-gradient-to-br from-purple-100 to-white",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6 text-purple-600"}),e.jsxs("h3",{className:"text-xl font-bold text-purple-600",children:[s.currentPoints," Points"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-orange-500"}),e.jsxs("span",{className:"text-muted-foreground",children:["SÃ©rie: ",s.currentTaskStreak," jours"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("span",{className:"text-muted-foreground",children:[s.tasksCompleted," tÃ¢ches"]})]})]})]})})]}):null,S=({userId:s})=>{const[t,i]=c.useState([]),[o,x]=c.useState(!0);if(c.useEffect(()=>{if(!s)return;(async()=>{try{const{data:l,error:n}=await v.from("xp_transactions").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(20);if(n)throw n;const d=(l||[]).map(a=>({id:a.id,userId:a.user_id,sourceType:a.source_type,sourceId:a.source_id,xpGained:a.xp_gained,pointsGained:a.points_gained,description:a.description,metadata:a.metadata,createdAt:new Date(a.created_at)}));i(d)}catch(l){N.error("Failed to load transactions",{error:l.message})}finally{x(!1)}})()},[s]),o)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Chargement..."})});const u=r=>{switch(r){case"task":return"âœ…";case"habit":return"ðŸ’ª";case"challenge":return"ðŸŽ¯";case"streak_bonus":return"ðŸ”¥";case"project_created":return"ðŸ“";case"project_completed":return"ðŸŽ¯";default:return"ðŸ“Š"}},p=r=>{const n=new Date().getTime()-r.getTime(),d=Math.floor(n/6e4),a=Math.floor(n/36e5),g=Math.floor(n/864e5);return d<1?"Ã€ l'instant":d<60?`Il y a ${d}min`:a<24?`Il y a ${a}h`:`Il y a ${g}j`};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(y,{className:"w-5 h-5 text-reward"}),e.jsx("h3",{className:"text-lg font-semibold",children:"ActivitÃ© rÃ©cente"})]}),t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 mx-auto text-muted-foreground mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucune activitÃ© rÃ©cente"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"ComplÃ©tez des tÃ¢ches pour gagner de l'XP !"})]}),t.map(r=>e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:u(r.sourceType)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:r.description||"ActivitÃ©"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:p(r.createdAt)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-reward-dark",children:["+",r.xpGained," XP"]}),r.pointsGained>0&&e.jsxs("div",{className:"text-xs text-purple-600",children:["+",r.pointsGained," pts"]})]})]})},r.id))]})},_=({level:s})=>{const[t,i]=c.useState(!0);return c.useEffect(()=>{const o=setTimeout(()=>i(!1),3e3);return()=>clearTimeout(o)},[]),t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:e.jsx("div",{className:"animate-bounce",children:e.jsx("div",{className:"bg-gradient-to-br from-reward to-reward-dark text-white rounded-2xl p-8 shadow-2xl",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(m,{className:"w-16 h-16"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold",children:["Niveau ",s," !"]}),e.jsx("div",{className:"text-lg mt-2",children:"Bravo, vous progressez !"})]})]})})})}):null},E=({className:s})=>{const{data:t,state:i}=A();return e.jsx(T,{header:{title:"RÃ©compenses",subtitle:"Suivez votre progression et vos accomplissements",icon:e.jsx(m,{className:"w-5 h-5"})},state:i.loading?"loading":"success",loadingProps:{variant:"cards"},className:s,children:e.jsxs("div",{className:"space-y-6 pb-20 md:pb-6",children:[t.levelUpAnimation&&e.jsx(_,{level:t.progressStats.level}),e.jsx(k,{progress:t.progress,progressPercentage:t.progressStats.progressPercent}),e.jsx(S,{userId:t.userId||""})]})})};export{E as default};
