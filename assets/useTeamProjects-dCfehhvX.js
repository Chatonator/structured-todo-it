import{r as n,aA as D,aS as E,aF as u}from"./index-DkVHath_.js";const g=r=>({id:r.id,teamId:r.team_id,name:r.name,description:r.description||void 0,icon:r.icon||"üìÅ",color:r.color||"#a78bfa",status:r.status,targetDate:r.target_date?new Date(r.target_date):void 0,orderIndex:r.order_index,progress:r.progress,createdBy:r.created_by,createdAt:new Date(r.created_at),updatedAt:new Date(r.updated_at),completedAt:r.completed_at?new Date(r.completed_at):void 0,kanbanColumns:r.kanban_columns||void 0,showInSidebar:r.show_in_sidebar??!1}),S=r=>{const[f,l]=n.useState([]),[b,m]=n.useState(!1),{user:a}=D(),{toast:i}=E(),p=n.useCallback(async()=>{if(!r||!a){l([]);return}m(!0);try{const{data:o,error:e}=await u.from("team_projects").select("*").eq("team_id",r).order("order_index",{ascending:!0});if(e)throw e;l((o||[]).map(g))}catch(o){console.error("Error fetching team projects:",o),i({title:"Erreur",description:"Impossible de charger les projets d'√©quipe",variant:"destructive"})}finally{m(!1)}},[r,a,i]);n.useEffect(()=>{p()},[p]);const j=n.useCallback(async(o,e,t,s)=>{if(!r||!a)return null;try{const{data:d,error:c}=await u.from("team_projects").insert({team_id:r,name:o,description:e||null,icon:t||"üìÅ",color:s||"#a78bfa",created_by:a.id,order_index:f.length}).select().single();if(c)throw c;const _=g(d);return l(y=>[...y,_]),i({title:"Projet cr√©√©",description:`Le projet "${o}" a √©t√© cr√©√©`}),_}catch(d){return console.error("Error creating team project:",d),i({title:"Erreur",description:"Impossible de cr√©er le projet",variant:"destructive"}),null}},[r,a,f.length,i]),v=n.useCallback(async(o,e)=>{if(!r||!a)return!1;try{const t={};e.name!==void 0&&(t.name=e.name),e.description!==void 0&&(t.description=e.description),e.icon!==void 0&&(t.icon=e.icon),e.color!==void 0&&(t.color=e.color),e.status!==void 0&&(t.status=e.status,e.status==="completed"&&(t.completed_at=new Date().toISOString())),e.targetDate!==void 0&&(t.target_date=e.targetDate?e.targetDate.toISOString().split("T")[0]:null),e.orderIndex!==void 0&&(t.order_index=e.orderIndex),e.progress!==void 0&&(t.progress=e.progress),e.kanbanColumns!==void 0&&(t.kanban_columns=e.kanbanColumns),e.showInSidebar!==void 0&&(t.show_in_sidebar=e.showInSidebar);const{error:s}=await u.from("team_projects").update(t).eq("id",o).eq("team_id",r);if(s)throw s;return l(d=>d.map(c=>c.id===o?{...c,...e,updatedAt:new Date}:c)),!0}catch(t){return console.error("Error updating team project:",t),i({title:"Erreur",description:"Impossible de mettre √† jour le projet",variant:"destructive"}),!1}},[r,a,i]),h=n.useCallback(async o=>{if(!r||!a)return!1;try{const{error:e}=await u.from("team_projects").delete().eq("id",o).eq("team_id",r);if(e)throw e;return l(t=>t.filter(s=>s.id!==o)),i({title:"Projet supprim√©",description:"Le projet a √©t√© supprim√©"}),!0}catch(e){return console.error("Error deleting team project:",e),i({title:"Erreur",description:"Impossible de supprimer le projet (seuls les admins peuvent supprimer)",variant:"destructive"}),!1}},[r,a,i]);return{projects:f,loading:b,createProject:j,updateProject:v,deleteProject:h,refetch:p}};export{S as u};
