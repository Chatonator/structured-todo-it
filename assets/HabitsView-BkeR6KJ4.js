import{i as Ne,a9 as Ce,r as x,aA as Re,aF as J,p as R,s as ke,q as H,G as ne,j as e,a3 as we,a4 as De,c as O,$ as Se,a6 as Me,a7 as K,aZ as Ve,b4 as Be,C as L,d as z,T as Te,ad as ie,a as X,b as Z,x as ee,y as We,z as Ee,D as He,E as Ae,F as Oe,e as Ue,B as Ge,O as Ie,b5 as _e,aK as le,aL as oe,aM as de,aN as ce,U as Ke,V as Je,W as Q,b2 as Y,at as N,Q as F,af as me,ag as ue,ah as xe,ai as he,b6 as pe,aj as fe,b7 as Qe,aU as ge,b8 as Ye,b9 as Xe,ba as Ze,aR as qe,R as Fe,Y as se,bb as es,bc as ss,bd as ts,H as je}from"./index-DkVHath_.js";import{F as Le}from"./flame-CI-j9JJ8.js";import{T as te}from"./trending-up-DQ6s5-C7.js";import{K as as,U as Pe,X as ae,Y as re,V as rs,R as be,N as ns,O as ye,Q as is}from"./AreaChart-B3H-ve17.js";import{E as ls}from"./ellipsis-vertical-Bc4UBk8X.js";import{S as os}from"./star-C7zlGHyC.js";import{V as ds}from"./ViewLayout-ya6HA0TA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Ne("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=Ne("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);function ms(t){return Ce(t).getDate()}function us(t){return Ce(t).getDay()}var xs=as({chartName:"BarChart",GraphicalChild:Pe,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:ae},{axisType:"yAxis",AxisComp:re}],formatAxisMap:rs});const hs=()=>{const[t,i]=x.useState({bestCurrentStreak:0,longestStreak:0,weeklyCompletions:0,overallCompletionRate:0,totalHabits:0,dailyTrends:[],monthlyData:[],loading:!0}),{user:o}=Re(),a=x.useCallback((r,h)=>{if(r.isLocked||r.isChallenge&&r.challengeEndDate&&h>new Date(r.challengeEndDate))return!1;if(r.frequency==="daily"||r.frequency==="x-times-per-week"||r.frequency==="x-times-per-month")return!0;if((r.frequency==="weekly"||r.frequency==="custom")&&r.targetDays){const l=us(h),d=l===0?6:l-1;return r.targetDays.includes(d)}if(r.frequency==="monthly"&&r.targetDays){const l=ms(h);return r.targetDays.includes(l)}return!0},[]),f=x.useCallback(async()=>{if(!o){i(r=>({...r,loading:!1}));return}try{const{data:r,error:h}=await J.from("time_events").select("id, entity_id, recurrence").eq("entity_type","habit").eq("user_id",o.id);if(h)throw h;if(!r||r.length===0){i({bestCurrentStreak:0,longestStreak:0,weeklyCompletions:0,overallCompletionRate:0,totalHabits:0,dailyTrends:[],monthlyData:[],loading:!1});return}const{data:l}=await J.from("items").select("id, metadata").eq("user_id",o.id).eq("item_type","habit"),d=new Map;(l||[]).forEach(c=>{const p=c.metadata||{};d.set(c.id,{id:c.id,frequency:p.frequency||"daily",targetDays:p.targetDays,isActive:p.isActive??!0})});const u=r.map(c=>c.id),w=new Date,j=R(w,35),b=ke(w,{weekStartsOn:1}),{data:n,error:I}=await J.from("time_occurrences").select("event_id, starts_at, status").in("event_id",u).eq("user_id",o.id).gte("starts_at",j.toISOString()).order("starts_at",{ascending:!1});if(I)throw I;const P=(n||[]).filter(c=>c.status==="completed"&&new Date(c.starts_at)>=b).length;let _=0;for(let c=0;c<30;c++){const p=R(w,c);for(const D of r){const v=d.get(D.entity_id);v&&v.isActive&&a(v,p)&&_++}}const $=(n||[]).filter(c=>c.status==="completed").length,C=_>0?Math.min(100,Math.round($/_*100)):0;let y=0,E=0;for(const c of r){const p=(n||[]).filter(m=>m.event_id===c.id&&m.status==="completed").map(m=>H(new Date(m.starts_at),"yyyy-MM-dd")).sort((m,g)=>g.localeCompare(m));let D=0;for(let m=0;m<p.length;m++){const g=H(R(w,m),"yyyy-MM-dd");if(p[m]===g)D++;else break}let v=0,k=0;const S=[...p].sort();for(let m=0;m<S.length;m++){if(m===0)v=1;else{const g=new Date(S[m-1]);(new Date(S[m]).getTime()-g.getTime())/(1e3*60*60*24)===1?v++:v=1}k=Math.max(k,v)}y=Math.max(y,D),E=Math.max(E,k)}const q=[];for(let c=6;c>=0;c--){const p=R(w,c),D=H(p,"yyyy-MM-dd"),v=H(p,"EEE",{locale:ne}),k=(n||[]).filter(g=>g.status==="completed"&&H(new Date(g.starts_at),"yyyy-MM-dd")===D).length;let S=0;for(const g of r){const A=d.get(g.entity_id);A&&A.isActive&&a(A,p)&&S++}const m=S>0?Math.round(k/S*100):0;q.push({date:D,day:v.charAt(0).toUpperCase()+v.slice(1),completions:k,total:S,rate:m})}const T=[];for(let c=34;c>=0;c--){const p=R(w,c),D=H(p,"yyyy-MM-dd"),v=(n||[]).filter(m=>m.status==="completed"&&H(new Date(m.starts_at),"yyyy-MM-dd")===D).length;let k=0;for(const m of r){const g=d.get(m.entity_id);g&&g.isActive&&a(g,p)&&k++}const S=k>0?Math.round(v/k*100):0;T.push({date:D,count:v,total:k,rate:S})}i({bestCurrentStreak:y,longestStreak:E,weeklyCompletions:P,overallCompletionRate:C,totalHabits:r.length,dailyTrends:q,monthlyData:T,loading:!1})}catch(r){console.error("Error calculating habit stats:",r),i(h=>({...h,loading:!1}))}},[o,a]);return x.useEffect(()=>{f()},[f]),{...t,refresh:f}},ps=({decks:t,selectedDeckId:i,onSelectDeck:o,onManageDecks:a})=>{const f=t.find(r=>r.id===i);return e.jsxs(we,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:"w-full justify-between border-habit",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[(f==null?void 0:f.icon)&&e.jsx("span",{className:"text-xl",children:f.icon}),e.jsx("span",{className:"font-semibold",children:(f==null?void 0:f.name)||"SÃ©lectionner un deck"})]}),e.jsx(Se,{className:"w-4 h-4 ml-2"})]})}),e.jsxs(Me,{align:"start",className:"w-64",children:[t.map(r=>e.jsx(K,{onClick:()=>o(r.id),className:i===r.id?"bg-habit-light":"",children:e.jsxs("span",{className:"flex items-center gap-2",children:[r.icon&&e.jsx("span",{className:"text-xl",children:r.icon}),e.jsx("span",{children:r.name})]})},r.id)),e.jsx(Ve,{}),e.jsxs(K,{onClick:a,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"GÃ©rer les decks"]})]})]})},fs=t=>t===0?"Commencez votre journÃ©e ! ðŸŒ…":t<50?"Continuez comme Ã§a ! ðŸ’ª":t<100?"Presque terminÃ© ! ðŸŽ¯":"Bravo ! JournÃ©e parfaite ! ðŸŽ‰",gs=({completionRate:t,completedCount:i,totalCount:o})=>e.jsx(L,{className:"p-6 bg-gradient-to-r from-habit-light to-white dark:from-habit-dark/20 dark:to-background border-habit/20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Aujourd'hui"}),e.jsxs("span",{className:"text-2xl font-bold text-habit",children:[t,"%"]})]}),e.jsx("div",{className:"w-full bg-border rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-habit transition-all duration-500 ease-out",style:{width:`${t}%`}})}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[i," / ",o," habitudes complÃ©tÃ©es"]}),e.jsx("span",{className:"text-habit font-medium",children:fs(t)})]})]})}),js=({bestCurrentStreak:t,longestStreak:i,weeklyCompletions:o,overallCompletionRate:a})=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsx(L,{className:"bg-habit-light dark:bg-habit/20 border-habit/20",children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx(Le,{className:"w-5 h-5 text-habit mx-auto mb-1"}),e.jsx("div",{className:"text-2xl font-bold text-habit",children:t}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Streak actuel"})]})}),e.jsx(L,{className:"bg-card border-border",children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx(Te,{className:"w-5 h-5 text-reward mx-auto mb-1"}),e.jsx("div",{className:"text-2xl font-bold text-reward",children:i}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Record streak"})]})}),e.jsx(L,{className:"bg-card border-border",children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx(ie,{className:"w-5 h-5 text-primary mx-auto mb-1"}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:o}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Cette semaine"})]})}),e.jsx(L,{className:"bg-card border-border",children:e.jsxs(z,{className:"p-4 text-center",children:[e.jsx(te,{className:"w-5 h-5 text-system-success mx-auto mb-1"}),e.jsxs("div",{className:"text-2xl font-bold text-system-success",children:[a,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Taux (30j)"})]})})]}),ve=({active:t,payload:i,label:o})=>t&&i&&i.length?e.jsxs("div",{className:"bg-popover border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:o}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i[0].payload.completions,"/",i[0].payload.total," habitudes"]}),e.jsxs("p",{className:"text-sm font-semibold text-habit",children:[i[0].value,"% complÃ©tÃ©"]})]}):null,bs=({dailyTrends:t})=>!t||t.length===0?null:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs(L,{className:"bg-card border-border",children:[e.jsx(X,{className:"pb-2",children:e.jsxs(Z,{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-habit"}),"Taux de complÃ©tion (7 jours)"]})}),e.jsx(z,{className:"pt-0",children:e.jsx("div",{className:"h-[180px] w-full",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(ns,{data:t,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"habitGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--habit))",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--habit))",stopOpacity:0})]})}),e.jsx(ae,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"hsl(var(--muted-foreground))"}}),e.jsx(re,{domain:[0,100],axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"hsl(var(--muted-foreground))"},tickFormatter:i=>`${i}%`}),e.jsx(ye,{content:e.jsx(ve,{})}),e.jsx(is,{type:"monotone",dataKey:"rate",stroke:"hsl(var(--habit))",strokeWidth:2,fill:"url(#habitGradient)"})]})})})})]}),e.jsxs(L,{className:"bg-card border-border",children:[e.jsx(X,{className:"pb-2",children:e.jsxs(Z,{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-primary"}),"Habitudes complÃ©tÃ©es par jour"]})}),e.jsx(z,{className:"pt-0",children:e.jsx("div",{className:"h-[180px] w-full",children:e.jsx(be,{width:"100%",height:"100%",children:e.jsxs(xs,{data:t,margin:{top:10,right:10,left:-20,bottom:0},children:[e.jsx(ae,{dataKey:"day",axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"hsl(var(--muted-foreground))"}}),e.jsx(re,{axisLine:!1,tickLine:!1,tick:{fontSize:11,fill:"hsl(var(--muted-foreground))"},allowDecimals:!1}),e.jsx(ye,{content:e.jsx(ve,{})}),e.jsx(Pe,{dataKey:"completions",fill:"hsl(var(--habit))",radius:[4,4,0,0],maxBarSize:40})]})})})})]})]}),ys=({monthlyData:t})=>{const i=new Date,o=ke(R(i,28),{weekStartsOn:1}),a=[];for(let l=0;l<5;l++){const d=[];for(let u=0;u<7;u++)d.push(ee(o,l*7+u));a.push(d)}const f=l=>{const d=H(l,"yyyy-MM-dd");return t.find(u=>u.date===d)},r=l=>l===0?"bg-muted":l<25?"bg-habit/20":l<50?"bg-habit/40":l<75?"bg-habit/60":l<100?"bg-habit/80":"bg-habit",h=["L","M","M","J","V","S","D"];return e.jsxs(L,{className:"mt-4",children:[e.jsx(X,{className:"pb-2",children:e.jsxs(Z,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-habit"}),"Calendrier des 5 derniÃ¨res semaines"]})}),e.jsx(z,{children:e.jsxs(Ee,{children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"flex gap-1 mb-1",children:h.map((l,d)=>e.jsx("div",{className:"w-8 h-4 flex items-center justify-center text-xs text-muted-foreground",children:l},d))}),a.map((l,d)=>e.jsx("div",{className:"flex gap-1",children:l.map((u,w)=>{const j=f(u),b=H(u,"yyyy-MM-dd")===H(i,"yyyy-MM-dd"),n=u>i;return e.jsxs(He,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx("div",{className:`
                            w-8 h-8 rounded-md flex items-center justify-center text-xs
                            transition-all duration-200 cursor-default
                            ${n?"bg-muted/30":r((j==null?void 0:j.rate)||0)}
                            ${b?"ring-2 ring-habit ring-offset-1 ring-offset-background":""}
                          `,children:H(u,"d")})}),e.jsxs(Oe,{children:[e.jsx("p",{className:"font-medium",children:H(u,"EEEE d MMMM",{locale:ne})}),!n&&j&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[j.count,"/",j.total," habitudes (",j.rate,"%)"]}),!n&&!j&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnÃ©e"})]})]},w)})},d))]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 justify-end",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Moins"}),e.jsx("div",{className:"w-4 h-4 rounded bg-muted"}),e.jsx("div",{className:"w-4 h-4 rounded bg-habit/20"}),e.jsx("div",{className:"w-4 h-4 rounded bg-habit/40"}),e.jsx("div",{className:"w-4 h-4 rounded bg-habit/60"}),e.jsx("div",{className:"w-4 h-4 rounded bg-habit/80"}),e.jsx("div",{className:"w-4 h-4 rounded bg-habit"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Plus"})]})]})})]})},vs=({streak:t})=>e.jsx(Ee,{children:e.jsxs(He,{children:[e.jsx(Ae,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-habit-light text-habit border border-habit/20",children:[e.jsx("span",{className:"text-sm",children:"ðŸ”¥"}),e.jsx("span",{className:"text-sm font-bold",children:t.currentStreak})]})}),e.jsx(Oe,{children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:["SÃ©rie actuelle : ",t.currentStreak," jours"]}),e.jsxs("p",{children:["Record : ",t.longestStreak," jours"]})]})})]})}),Ns=t=>{switch(t.frequency){case"daily":return"Quotidien";case"weekly":return"Hebdo";case"x-times-per-week":return`${t.timesPerWeek}x/sem`;case"monthly":return t.targetDays&&t.targetDays.length>0?t.targetDays.length===1?`Le ${t.targetDays[0]}`:`${t.targetDays.length} jours/mois`:"Mensuel";case"x-times-per-month":return`${t.timesPerMonth||1}x/mois`;case"custom":return t.targetDays&&t.targetDays.length>0?t.targetDays.length===5&&!t.targetDays.includes(5)&&!t.targetDays.includes(6)?"Semaine":t.targetDays.length===2&&t.targetDays.includes(5)&&t.targetDays.includes(6)?"Weekend":t.targetDays.map(i=>{var o;return((o=_e[i])==null?void 0:o.short)||""}).join(""):"PersonnalisÃ©";default:return""}},Cs=({habit:t,isCompleted:i,streak:o,isApplicableToday:a=!0,onToggle:f,onEdit:r,onDelete:h})=>{const l=Ns(t),d=t.frequency!=="daily";return e.jsxs("div",{className:`flex items-center gap-3 p-4 bg-card rounded-lg border border-border hover:shadow-md transition-all ${a?"":"opacity-50"}`,children:[e.jsx(Ue,{checked:i,onCheckedChange:f,disabled:!a,className:"data-[state=checked]:bg-habit data-[state=checked]:border-habit"}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[t.icon&&e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-medium ${i?"line-through text-muted-foreground":"text-foreground"}`,children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),d&&e.jsxs(Ge,{variant:"outline",className:"text-xs flex items-center gap-1 bg-muted/50",children:[e.jsx(ie,{className:"w-3 h-3"}),l]})]})]}),o&&o.currentStreak>0&&e.jsx(vs,{streak:o})]}),e.jsxs(we,{children:[e.jsx(De,{asChild:!0,children:e.jsx(O,{variant:"ghost",size:"sm",children:e.jsx(ls,{className:"w-4 h-4"})})}),e.jsxs(Me,{align:"end",children:[e.jsxs(K,{onClick:r,children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),"Modifier"]}),e.jsxs(K,{onClick:h,className:"text-destructive",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Supprimer"]})]})]})]})},ks=["ðŸ’ª","ðŸƒ","ðŸ“š","ðŸ§˜","ðŸ’§","ðŸ¥—","ðŸ˜´","ðŸŽ¯","âœï¸","ðŸŽ¨","ðŸŽµ","ðŸ§ ","ðŸš€","ðŸ’¼","ðŸ‹ï¸","ðŸ§¹"],ws=({isOpen:t,onClose:i,onSave:o,habit:a,availableHabits:f=[],isProgressionDeck:r=!1})=>{var U;const[h,l]=x.useState(""),[d,u]=x.useState(""),[w,j]=x.useState("ðŸ’ª"),[b,n]=x.useState("daily"),[I,P]=x.useState(3),[_,$]=x.useState(4),[C,y]=x.useState([]),[E,q]=x.useState(!1),[T,c]=x.useState(30),[p,D]=x.useState(30),[v,k]=x.useState("archive"),[S,m]=x.useState(!1),[g,A]=x.useState({type:"streak",value:7});x.useEffect(()=>{a?(l(a.name),u(a.description||""),j(a.icon||"ðŸ’ª"),n(a.frequency),P(a.timesPerWeek||3),$(a.timesPerMonth||4),y(a.targetDays||[]),q(a.isChallenge||!1),c(a.challengeDurationDays||30),D(a.challengeDurationDays||30),k(a.challengeEndAction||"archive"),m(a.isLocked||!1),A(a.unlockCondition||{type:"streak",value:7})):(l(""),u(""),j("ðŸ’ª"),n("daily"),P(3),$(4),y([]),q(!1),c(30),D(30),k("archive"),m(!1),A({type:"streak",value:7}))},[a,t]);const V=s=>{s.preventDefault();const M=E?new Date:void 0,G=T===0?p:T,ze=E&&M?ee(M,G):void 0;o({userId:"",name:h,category:"Quotidien",context:"Perso",estimatedTime:15,description:d||void 0,deckId:(a==null?void 0:a.deckId)||"",frequency:b,timesPerWeek:b==="x-times-per-week"?I:void 0,timesPerMonth:b==="x-times-per-month"?_:void 0,targetDays:["weekly","monthly","custom"].includes(b)?C:void 0,isActive:!0,updatedAt:new Date,order:(a==null?void 0:a.order)||0,icon:w,isChallenge:E,challengeStartDate:M,challengeEndDate:ze,challengeDurationDays:E?G:void 0,challengeEndAction:E?v:void 0,isLocked:r?S:!1,unlockCondition:r&&S?g:void 0})},B=s=>{y(M=>M.includes(s)?M.filter(G=>G!==s):[...M,s])},W=()=>H(ee(new Date,T===0?p:T),"PPP",{locale:ne});return e.jsx(le,{open:t,onOpenChange:i,children:e.jsxs(oe,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsx(ce,{children:a?"Modifier l'habitude":"Nouvelle habitude"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs(Ke,{defaultValue:"base",className:"w-full",children:[e.jsxs(Je,{className:"grid w-full grid-cols-3",children:[e.jsx(Q,{value:"base",children:"Base"}),e.jsx(Q,{value:"frequency",children:"FrÃ©quence"}),e.jsx(Q,{value:"advanced",children:"AvancÃ©"})]}),e.jsxs(Y,{value:"base",className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"name",children:"Nom de l'habitude"}),e.jsx(F,{id:"name",value:h,onChange:s=>l(s.target.value),placeholder:"Ex: MÃ©diter 10 minutes",required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"description",children:"Description (optionnel)"}),e.jsx(F,{id:"description",value:d,onChange:s=>u(s.target.value),placeholder:"Ex: MÃ©ditation guidÃ©e le matin"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"IcÃ´ne"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:ks.map(s=>e.jsx("button",{type:"button",onClick:()=>j(s),className:`text-2xl p-2 rounded border transition-colors ${w===s?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,children:s},s))})]})]}),e.jsxs(Y,{value:"frequency",className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"frequency",children:"FrÃ©quence"}),e.jsxs(me,{value:b,onValueChange:s=>n(s),children:[e.jsx(ue,{children:e.jsx(xe,{})}),e.jsx(he,{children:pe.map(s=>e.jsx(fe,{value:s.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]})},s.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:(U=pe.find(s=>s.value===b))==null?void 0:U.description})]}),b==="x-times-per-week"&&e.jsxs("div",{children:[e.jsx(N,{htmlFor:"times",children:"Nombre de fois par semaine"}),e.jsx(F,{id:"times",type:"number",min:1,max:7,value:I,onChange:s=>P(parseInt(s.target.value)||1)})]}),b==="x-times-per-month"&&e.jsxs("div",{children:[e.jsx(N,{htmlFor:"timesMonth",children:"Nombre de fois par mois"}),e.jsx(F,{id:"timesMonth",type:"number",min:1,max:31,value:_,onChange:s=>$(parseInt(s.target.value)||1)})]}),(b==="weekly"||b==="custom")&&e.jsxs("div",{children:[e.jsx(N,{children:"Jours de la semaine"}),e.jsxs("div",{className:"flex gap-2 mt-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>y([0,1,2,3,4]),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${C.length===5&&!C.includes(5)&&!C.includes(6)?"bg-primary text-primary-foreground border-primary":"border-border text-muted-foreground hover:border-primary/50"}`,children:"Semaine"}),e.jsx("button",{type:"button",onClick:()=>y([5,6]),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${C.length===2&&C.includes(5)&&C.includes(6)?"bg-primary text-primary-foreground border-primary":"border-border text-muted-foreground hover:border-primary/50"}`,children:"Weekend"}),e.jsx("button",{type:"button",onClick:()=>y([0,1,2,3,4,5,6]),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${C.length===7?"bg-primary text-primary-foreground border-primary":"border-border text-muted-foreground hover:border-primary/50"}`,children:"Tous"})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:_e.map(s=>e.jsx("button",{type:"button",onClick:()=>B(s.value),className:`px-3 py-2 rounded border text-sm font-medium transition-colors ${C.includes(s.value)?"bg-primary text-primary-foreground border-primary":"border-border text-foreground hover:border-primary/50"}`,children:s.short},s.value))})]}),b==="monthly"&&e.jsxs("div",{children:[e.jsx(N,{children:"Jours du mois"}),e.jsxs("div",{className:"flex gap-2 mt-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>y([1]),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${C.length===1&&C[0]===1?"bg-primary text-primary-foreground border-primary":"border-border text-muted-foreground hover:border-primary/50"}`,children:"1er du mois"}),e.jsx("button",{type:"button",onClick:()=>y([1,15]),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${C.length===2&&C.includes(1)&&C.includes(15)?"bg-primary text-primary-foreground border-primary":"border-border text-muted-foreground hover:border-primary/50"}`,children:"1er et 15"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:Qe.map(s=>e.jsx("button",{type:"button",onClick:()=>B(s.value),className:`p-2 rounded border text-xs font-medium transition-colors ${C.includes(s.value)?"bg-primary text-primary-foreground border-primary":"border-border text-foreground hover:border-primary/50"}`,children:s.label},s.value))})]})]}),e.jsxs(Y,{value:"advanced",className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"challenge-mode",className:"cursor-pointer",children:"Mode Challenge"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Habitude temporaire avec une durÃ©e limitÃ©e"})]})]}),e.jsx(ge,{id:"challenge-mode",checked:E,onCheckedChange:q})]}),E&&e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx(N,{children:"DurÃ©e du challenge"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ye.map(s=>e.jsx("button",{type:"button",onClick:()=>c(s.value),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${T===s.value?"bg-orange-500 text-white border-orange-500":"border-border text-muted-foreground hover:border-orange-500/50"}`,children:s.label},s.value))})]}),T===0&&e.jsxs("div",{children:[e.jsx(N,{htmlFor:"customDuration",children:"DurÃ©e personnalisÃ©e (jours)"}),e.jsx(F,{id:"customDuration",type:"number",min:1,max:365,value:p,onChange:s=>D(parseInt(s.target.value)||1)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs("span",{children:["Fin prÃ©vue: ",W()]})]}),e.jsxs("div",{children:[e.jsx(N,{children:"Ã€ la fin du challenge"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Xe.map(s=>e.jsxs("button",{type:"button",onClick:()=>k(s.value),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${v===s.value?"bg-primary text-primary-foreground border-primary":"border-border text-muted-foreground hover:border-primary/50"}`,title:s.description,children:[s.icon," ",s.label]},s.value))})]})]})]}),r&&e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"locked-mode",className:"cursor-pointer",children:"Habitude verrouillÃ©e"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Doit Ãªtre dÃ©bloquÃ©e par une autre habitude"})]})]}),e.jsx(ge,{id:"locked-mode",checked:S,onCheckedChange:m})]}),S&&e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Condition de dÃ©verrouillage"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ze.map(s=>e.jsxs("button",{type:"button",onClick:()=>A(M=>({...M,type:s.value})),className:`px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${g.type===s.value?"bg-purple-500 text-white border-purple-500":"border-border text-muted-foreground hover:border-purple-500/50"}`,title:s.description,children:[s.icon," ",s.label]},s.value))})]}),g.type!=="manual"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"prerequisiteHabit",children:"Habitude prÃ©requise"}),e.jsxs(me,{value:g.prerequisiteHabitId||"",onValueChange:s=>A(M=>({...M,prerequisiteHabitId:s})),children:[e.jsx(ue,{children:e.jsx(xe,{placeholder:"Choisir une habitude..."})}),e.jsx(he,{children:f.filter(s=>s.id!==(a==null?void 0:a.id)).map(s=>e.jsxs(fe,{value:s.id,children:[s.icon," ",s.name]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"unlockValue",children:g.type==="streak"?"Jours de streak minimum":"Nombre de complÃ©tions"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{id:"unlockValue",type:"number",min:1,max:365,value:g.value||7,onChange:s=>A(M=>({...M,value:parseInt(s.target.value)||1}))}),g.type==="streak"&&e.jsx(Le,{className:"h-5 w-5 text-orange-500"})]})]})]})]})]})]})]}),e.jsxs(qe,{children:[e.jsx(O,{type:"button",variant:"outline",onClick:i,children:"Annuler"}),e.jsx(O,{type:"submit",children:a?"Mettre Ã  jour":"CrÃ©er"})]})]})]})})},Ds=["ðŸŽ¯","ðŸ’ª","ðŸŒ±","ðŸ§˜","ðŸ“š","ðŸƒ","ðŸŽ¨","ðŸ§ ","âœ¨","ðŸŒŸ"],Ss=({isOpen:t,onClose:i,onSave:o,deck:a})=>{const[f,r]=x.useState(""),[h,l]=x.useState(""),[d,u]=x.useState("ðŸŽ¯"),[w,j]=x.useState(!1);Fe.useEffect(()=>{a?(r(a.name),l(a.description||""),u(a.icon||"ðŸŽ¯"),j(a.isDefault||!1)):(r(""),l(""),u("ðŸŽ¯"),j(!1))},[a,t]);const b=n=>{n.preventDefault(),o({name:f,category:"Quotidien",context:"Perso",estimatedTime:30,description:h||void 0,color:"#ec4899",icon:d,isDefault:w,order:(a==null?void 0:a.order)||0}),r(""),l(""),u("ðŸŽ¯"),j(!1),i()};return e.jsx(le,{open:t,onOpenChange:i,children:e.jsxs(oe,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(ce,{children:a?"Modifier le deck":"Nouveau deck"})}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"deck-name",children:"Nom du deck"}),e.jsx(F,{id:"deck-name",value:f,onChange:n=>r(n.target.value),placeholder:"Ex: SantÃ© & Bien-Ãªtre",required:!0})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"deck-description",children:"Description (optionnel)"}),e.jsx(F,{id:"deck-description",value:h,onChange:n=>l(n.target.value),placeholder:"Ex: Habitudes pour rester en forme"})]}),e.jsxs("div",{children:[e.jsx(N,{children:"IcÃ´ne"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ds.map(n=>e.jsx("button",{type:"button",onClick:()=>u(n),className:`text-2xl p-2 rounded border ${d===n?"border-habit bg-habit-light":"border-border"}`,children:n},n))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is-default",checked:w,onChange:n=>j(n.target.checked),className:"rounded border-border"}),e.jsx(N,{htmlFor:"is-default",className:"cursor-pointer",children:"DÃ©finir comme deck par dÃ©faut"})]}),e.jsxs(qe,{children:[e.jsx(O,{type:"button",variant:"outline",onClick:i,children:"Annuler"}),e.jsx(O,{type:"submit",className:"bg-habit hover:bg-habit-dark",children:a?"Mettre Ã  jour":"CrÃ©er"})]})]})]})})},Ms=({isOpen:t,onClose:i,decks:o,onCreateDeck:a,onUpdateDeck:f,onDeleteDeck:r})=>{const[h,l]=x.useState(!1),[d,u]=x.useState(null),w=async n=>{d?await f(d.id,n):await a(n),l(!1),u(null)},j=n=>{u(n),l(!0)},b=async n=>{confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le deck "${n.name}" et toutes ses habitudes ?`)&&await r(n.id)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{open:t,onOpenChange:i,children:e.jsxs(oe,{className:"sm:max-w-2xl",children:[e.jsx(de,{children:e.jsx(ce,{children:"GÃ©rer mes decks"})}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:o.map(n=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-card rounded-lg border border-border hover:shadow-md transition-all",children:[e.jsx("span",{className:"text-2xl",children:n.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-foreground",children:n.name}),n.isDefault&&e.jsx(os,{className:"w-4 h-4 text-habit fill-habit"})]}),n.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>j(n),children:e.jsx($e,{className:"w-4 h-4"})}),e.jsx(O,{variant:"ghost",size:"sm",onClick:()=>b(n),className:"text-destructive hover:text-destructive",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]},n.id))}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsxs(O,{onClick:()=>{u(null),l(!0)},className:"bg-habit hover:bg-habit-dark",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Nouveau deck"]}),e.jsx(O,{variant:"outline",onClick:i,children:"Fermer"})]})]})}),e.jsx(Ss,{isOpen:h,onClose:()=>{l(!1),u(null)},onSave:w,deck:d})]})},qs=()=>{const{decks:t,loading:i,defaultDeckId:o,createDeck:a,updateDeck:f,deleteDeck:r}=es(),[h,l]=x.useState(o),{habits:d,loading:u,toggleCompletion:w,createHabit:j,updateHabit:b,deleteHabit:n,isCompletedToday:I,isHabitApplicableToday:P,getHabitsForToday:_,getTodayCompletionRate:$,streaks:C}=ss(h),y=hs(),E=_(),[q,T]=x.useState(!1),[c,p]=x.useState(!1),[D,v]=x.useState(null),[k,S]=x.useState(!1);Fe.useEffect(()=>{o&&!h&&l(o)},[o,h]);const m=async s=>{D?await b(D.id,s):await j(s),T(!1),v(null)},g=s=>{v(s),T(!0)},A=async s=>{confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette habitude ?")&&await n(s)},V=i?"loading":t.length===0?"empty":"success",B=t.length===0?{title:"Aucun deck d'habitudes",description:"CrÃ©ez votre premier deck pour commencer Ã  suivre vos habitudes",icon:e.jsx(je,{className:"w-12 h-12"}),action:{label:"CrÃ©er mon premier deck",onClick:()=>p(!0)}}:void 0,W=t.find(s=>s.id===h),U=async s=>{const M=await a(s);return M&&(l(M),p(!1)),M};return e.jsxs(e.Fragment,{children:[e.jsx(ds,{header:{title:"Habitudes",subtitle:"Suivez vos habitudes quotidiennes",icon:e.jsx(je,{className:"w-5 h-5"}),actions:V==="success"&&h?e.jsxs(O,{onClick:()=>T(!0),size:"sm",className:"bg-habit hover:bg-habit-dark",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Ajouter"]}):void 0},state:V,loadingProps:{variant:"list"},emptyProps:B,children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4 pb-20 md:pb-6",children:[e.jsx("div",{children:e.jsx(ps,{decks:t,selectedDeckId:h,onSelectDeck:l,onManageDecks:()=>p(!0)})}),h&&e.jsxs(e.Fragment,{children:[e.jsx(gs,{completionRate:$(),completedCount:E.filter(s=>I(s.id)).length,totalCount:E.length}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:(W==null?void 0:W.name)||"Mes habitudes"})}),u?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Chargement des habitudes..."}):d.length===0?e.jsxs("div",{className:"text-center py-8 bg-card rounded-lg border border-border",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucune habitude dans ce deck"}),e.jsxs(O,{onClick:()=>T(!0),variant:"outline",className:"border-habit text-habit hover:bg-habit/10",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"CrÃ©er ma premiÃ¨re habitude"]})]}):e.jsx("div",{className:"space-y-2",children:d.map(s=>e.jsx(Cs,{habit:s,isCompleted:I(s.id),streak:C[s.id],isApplicableToday:P(s),onToggle:()=>w(s.id),onEdit:()=>g(s),onDelete:()=>A(s.id)},s.id))})]}),!y.loading&&y.totalHabits>0&&e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(!k),className:"flex items-center justify-between w-full py-3 px-4 bg-card rounded-lg border border-border hover:bg-muted/50 transition-colors",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Statistiques"}),k?e.jsx(ts,{className:"w-5 h-5 text-muted-foreground"}):e.jsx(Se,{className:"w-5 h-5 text-muted-foreground"})]}),k&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx(js,{bestCurrentStreak:y.bestCurrentStreak,longestStreak:y.longestStreak,weeklyCompletions:y.weeklyCompletions,overallCompletionRate:y.overallCompletionRate}),e.jsx(bs,{dailyTrends:y.dailyTrends}),e.jsx(ys,{monthlyData:y.monthlyData})]})]})]}),e.jsx(ws,{isOpen:q,onClose:()=>{T(!1),v(null)},onSave:m,habit:D})]})}),e.jsx(Ms,{isOpen:c,onClose:()=>p(!1),decks:t,onCreateDeck:U,onUpdateDeck:f,onDeleteDeck:r})]})};export{qs as default};
