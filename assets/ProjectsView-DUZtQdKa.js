import{i as Fe,aJ as Le,l as Xe,r as n,j as e,v as Ms,aK as Ye,aL as Ze,aM as Je,aN as We,B as _,aw as ce,at as X,Q as re,af as Ne,ag as we,ah as ye,ai as ke,aj as Te,c as P,aO as es,aP as Rs,ab as Ae,R as Ee,C as ss,d as ts,e as Os,t as Fs,O as ve,aQ as Ls,Y as as,aR as Es,aB as _s,aS as rs,aT as ns,aU as ls,aV as os,aW as is,aX as cs,P as ds,T as us,az as _e,ad as Be,S as ms,a3 as he,a4 as xe,ar as hs,a6 as ge,aY as pe,aZ as fe,a7 as je,X as xs,ae as gs,aI as ps,a_ as fs,aF as Bs,a$ as qe,b0 as $e,b1 as zs,a as Us,b as qs,U as $s,V as Vs,W as Se,b2 as De,g as Ks}from"./index-DkVHath_.js";import{u as js}from"./useTeamProjects-dCfehhvX.js";import{K as J,f as Gs,g as Hs,h as Qs,s as Xs,i as Ys,j as Zs,k as bs,a as Js,u as Ws,l as et,C as ze,m as st,n as tt,b as at,c as Ve,o as rt,P as nt,D as lt,d as ot,G as it}from"./core.esm-CPaT8Axd.js";import{V as ct}from"./ViewLayout-ya6HA0TA.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=Fe("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=Fe("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=Fe("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),ne={planning:{label:"Planification",color:"text-blue-600",bgColor:"bg-blue-100"},"in-progress":{label:"En cours",color:"text-project",bgColor:"bg-project/10"},"on-hold":{label:"En pause",color:"text-orange-600",bgColor:"bg-orange-100"},completed:{label:"TerminÃ©",color:"text-green-600",bgColor:"bg-green-100"},archived:{label:"ArchivÃ©",color:"text-muted-foreground",bgColor:"bg-muted"}},dt=["ðŸ“š","ðŸŽ¯","ðŸ’¼","ðŸ ","âœˆï¸","ðŸŽ¨","ðŸ’¡","ðŸš€","ðŸŽ“","â¤ï¸"],ut=["#a78bfa","#ec4899","#f59e0b","#10b981","#3b82f6","#ef4444"];function Ke(s){return{id:s.id,name:s.name,description:s.description,icon:s.icon||"ðŸ“š",color:s.color,status:s.status,targetDate:s.targetDate,progress:s.progress,createdAt:s.createdAt,updatedAt:s.updatedAt,completedAt:s.completedAt,orderIndex:s.orderIndex,userId:s.userId}}function Ge(s){return{id:s.id,name:s.name,description:s.description,icon:s.icon||"ðŸ“",color:s.color,status:s.status,targetDate:s.targetDate,progress:s.progress,createdAt:s.createdAt,updatedAt:s.updatedAt,completedAt:s.completedAt,orderIndex:s.orderIndex,teamId:s.teamId,createdBy:s.createdBy,kanbanColumns:s.kanbanColumns,showInSidebar:s.showInSidebar}}function mt(s){return!!s.teamId}const ht=()=>{const{currentTeam:s}=Le(),l=(s==null?void 0:s.id)??null,t=Xe(),a=js(l),r=!!l,i=n.useMemo(()=>r?a.projects.map(Ge):t.projects.map(Ke),[r,t.projects,a.projects]),o=r?a.loading:t.loading,g=n.useCallback(async(m,c,f,v)=>{if(r){const C=await a.createProject(m,c,f,v);return C?Ge(C):null}else{const C=await t.createProject(m,c,f,v);return C?Ke(C):null}},[r,a,t]),b=n.useCallback(async(m,c)=>r?a.updateProject(m,{name:c.name,description:c.description,icon:c.icon,color:c.color,status:c.status,targetDate:c.targetDate,progress:c.progress,orderIndex:c.orderIndex}):t.updateProject(m,{name:c.name,description:c.description,icon:c.icon,color:c.color,status:c.status,targetDate:c.targetDate,progress:c.progress,orderIndex:c.orderIndex}),[r,a,t]),j=n.useCallback(async m=>r?a.deleteProject(m):t.deleteProject(m),[r,a,t]),d=n.useCallback(async m=>r?a.updateProject(m,{status:"completed"}):t.completeProject(m),[r,a,t]),N=n.useCallback(()=>i.filter(m=>m.status!=="archived"&&m.status!=="completed"),[i]),u=n.useCallback(()=>i.filter(m=>m.status==="completed"),[i]),p=n.useCallback(()=>i.filter(m=>m.status==="archived"),[i]),x=n.useCallback(()=>{r?a.refetch():t.reloadProjects()},[r,a,t]);return{projects:i,loading:o,isTeamMode:r,teamId:l,teamName:(s==null?void 0:s.name)??null,createProject:g,updateProject:b,deleteProject:j,completeProject:d,getActiveProjects:N,getCompletedProjects:u,getArchivedProjects:p,reload:x}},Ns=n.forwardRef(({className:s,...l},t)=>e.jsx("textarea",{className:Ms("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l}));Ns.displayName="Textarea";const Re=({open:s,onClose:l,onSave:t,project:a,initialName:r,teamId:i})=>{const{teams:o,currentTeam:g}=Le(),[b,j]=n.useState(""),[d,N]=n.useState(""),[u,p]=n.useState("ðŸ“š"),[x,m]=n.useState("#a78bfa"),[c,f]=n.useState("planning"),[v,C]=n.useState(""),[T,w]=n.useState(null);n.useEffect(()=>{a?(j(a.name),N(a.description||""),p(a.icon||"ðŸ“š"),m(a.color),f(a.status),C(a.targetDate?a.targetDate.toISOString().split("T")[0]:""),w(null)):(j(r||""),N(""),p("ðŸ“š"),m("#a78bfa"),f("planning"),C(""),w(i||(g==null?void 0:g.id)||null))},[a,r,s,i,g==null?void 0:g.id]);const S=D=>{D.preventDefault(),t({name:b,description:d||void 0,icon:u,color:x,status:c,targetDate:v?new Date(v):void 0,teamId:T||void 0}),l()},k=a&&"teamId"in a&&!!a.teamId,A=!!i||k;T&&o.find(D=>D.id===T);const M=a?"Modifier le projet":A?"Nouveau projet d'Ã©quipe":"Nouveau projet";return e.jsx(Ye,{open:s,onOpenChange:l,children:e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsx(Je,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{children:M}),A&&e.jsxs(_,{variant:"secondary",className:"gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Ã‰quipe"]})]})}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"name",children:"Nom du projet *"}),e.jsx(re,{id:"name",value:b,onChange:D=>j(D.target.value),placeholder:"Ex: Ã‰crire un livre",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"description",children:"Description"}),e.jsx(Ns,{id:"description",value:d,onChange:D=>N(D.target.value),placeholder:"DÃ©crivez votre projet...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{children:"IcÃ´ne"}),e.jsxs(Ne,{value:u,onValueChange:p,children:[e.jsx(we,{children:e.jsx(ye,{})}),e.jsx(ke,{children:dt.map(D=>e.jsx(Te,{value:D,children:e.jsx("span",{className:"text-xl",children:D})},D))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{children:"Couleur"}),e.jsxs(Ne,{value:x,onValueChange:m,children:[e.jsx(we,{children:e.jsx(ye,{})}),e.jsx(ke,{children:ut.map(D=>e.jsx(Te,{value:D,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:D}}),D]})},D))})]})]})]}),a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{children:"Statut"}),e.jsxs(Ne,{value:c,onValueChange:f,children:[e.jsx(we,{children:e.jsx(ye,{})}),e.jsx(ke,{children:Object.entries(ne).map(([D,F])=>e.jsx(Te,{value:D,children:F.label},D))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"targetDate",children:"Date cible (optionnelle)"}),e.jsx(re,{id:"targetDate",type:"date",value:v,onChange:D=>C(D.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(P,{type:"button",variant:"outline",onClick:l,children:"Annuler"}),e.jsx(P,{type:"submit",children:a?"Mettre Ã  jour":"CrÃ©er"})]})]})]})})},xt=["todo","in-progress","done"],gt=s=>{const{items:l,loading:t,updateItem:a,reload:r}=es({contextTypes:["project_task"]}),i=n.useMemo(()=>l.filter(d=>d.parentId===s),[l,s]),o=n.useMemo(()=>i.map(Rs),[i]),g=n.useCallback(async(d,N)=>{const u=i.find(x=>x.id===d);if(!u)return console.error("updateTaskStatus: Item not found",{taskId:d,projectId:s}),!1;if(u.parentId!==s)return console.error("updateTaskStatus: Task no longer belongs to project",{taskId:d,expectedProject:s,actualProject:u.parentId}),!1;const p=N==="done";try{return await a(d,{isCompleted:p,metadata:{...u.metadata,projectStatus:N}}),!0}catch(x){return console.error("updateTaskStatus error:",x),!1}},[i,s,a]),b=n.useCallback(d=>{const N=(d==null?void 0:d.map(p=>p.id))||xt,u={};return N.forEach(p=>{u[p]=[]}),o.forEach(p=>{var m;const x=p.projectStatus||"todo";if(u[x])u[x].push(p);else{const c=N[0]||"todo";(m=u[c])==null||m.push(p)}}),u},[o]),j=n.useMemo(()=>({todo:o.filter(d=>!d.projectStatus||d.projectStatus==="todo"),inProgress:o.filter(d=>d.projectStatus==="in-progress"),done:o.filter(d=>d.projectStatus==="done")}),[o]);return{tasks:o,loading:t,tasksByStatus:j,getTasksByColumns:b,updateTaskStatus:g,reloadTasks:r}};function ws(s){const{tasks:l,getTaskName:t,getSubCategory:a,getEstimatedTime:r,getAssignedTo:i}=s,[o,g]=n.useState(""),[b,j]=n.useState("none"),[d,N]=n.useState("all"),u=n.useMemo(()=>o.trim()!==""||b!=="none"||d!=="all",[o,b,d]),p=n.useCallback(()=>{g(""),j("none"),N("all")},[]),x=n.useCallback(c=>{let f=[...c];if(o.trim()){const v=o.toLowerCase();f=f.filter(C=>t(C).toLowerCase().includes(v))}return d!=="all"&&(d==="none"?f=f.filter(v=>!a(v)):f=f.filter(v=>a(v)===d)),b!=="none"&&f.sort((v,C)=>{switch(b){case"priority-high":{const T=k=>{var M;const A=a(k);return A?((M=Ae[A])==null?void 0:M.priority)??0:0},w=T(v),S=T(C);return S===w?t(v).localeCompare(t(C)):S-w}case"priority-low":{const T=k=>{var M;const A=a(k);return A?((M=Ae[A])==null?void 0:M.priority)??0:0},w=T(v),S=T(C);return w===0&&S!==0?1:S===0&&w!==0?-1:w===S?t(v).localeCompare(t(C)):w-S}case"name":return t(v).localeCompare(t(C));case"time":return r(C)-r(v);case"assignee":return i?(i(v)||"zzz").localeCompare(i(C)||"zzz"):0;default:return 0}}),f},[o,b,d,t,a,r,i]),m=n.useMemo(()=>x(l),[l,x]);return{searchQuery:o,setSearchQuery:g,sortBy:b,setSortBy:j,priorityFilter:d,setPriorityFilter:N,hasActiveFilters:u,clearFilters:p,filterAndSortTasks:x,filteredTasks:m}}const ys=[{value:"all",label:"Toutes les prioritÃ©s"},{value:"Le plus important",label:"ðŸ”´ Le plus important"},{value:"Important",label:"ðŸŸ  Important"},{value:"Peut attendre",label:"ðŸŸ¡ Peut attendre"},{value:"Si j'ai le temps",label:"ðŸŸ¢ Si j'ai le temps"},{value:"none",label:"âšª Non dÃ©finie"}],Oe=[{value:"none",label:"Aucun tri"},{value:"priority-high",label:"PrioritÃ© â†“ (haute â†’ basse)"},{value:"priority-low",label:"PrioritÃ© â†‘ (basse â†’ haute)"},{value:"name",label:"Nom (A â†’ Z)"},{value:"time",label:"DurÃ©e (longue â†’ courte)"}],He=[...Oe,{value:"assignee",label:"Assignation"}],pt=({priority:s})=>{if(!s)return null;const l=Ae[s],t={"Le plus important":"ðŸ”´",Important:"ðŸŸ ","Peut attendre":"ðŸŸ¡","Si j'ai le temps":"ðŸŸ¢"}[s]||"";return e.jsxs(_,{variant:"outline",className:`text-xs ${(l==null?void 0:l.color)||""}`,children:[t," ",s]})},Ce=[{id:"todo",name:"Ã€ faire",color:"bg-muted",order:0},{id:"in-progress",name:"En cours",color:"bg-project/10",order:1},{id:"done",name:"TerminÃ©",color:"bg-green-50 dark:bg-green-900/20",order:2}],ft=({tasksByColumn:s,columns:l=Ce,onStatusChange:t,onTaskClick:a,onToggleComplete:r,onDeleteTask:i,renderTaskBadge:o})=>{const g=n.useCallback(x=>s[x]||[],[s]),b=n.useCallback((x,m)=>{x.dataTransfer.setData("taskId",m)},[]),j=n.useCallback(x=>{x.preventDefault()},[]),d=n.useCallback((x,m)=>{x.preventDefault();const c=x.dataTransfer.getData("taskId");c&&t(c,m)},[t]),N=n.useCallback((x,m)=>{x.stopPropagation(),window.confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette tÃ¢che ?")&&i(m)},[i]),u=[...l].sort((x,m)=>x.order-m.order),p=u.length<=3?"md:grid-cols-3":u.length<=4?"md:grid-cols-4":"md:grid-cols-5";return e.jsx("div",{className:`grid grid-cols-1 ${p} gap-4`,children:u.map(x=>{const m=g(x.id);return e.jsxs("div",{className:"flex flex-col",onDragOver:j,onDrop:c=>d(c,x.id),children:[e.jsx("div",{className:`${x.color} rounded-t-lg p-3 border-b`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:x.name}),e.jsx(_,{variant:"secondary",children:m.length})]})}),e.jsx("div",{className:"space-y-2 p-2 min-h-[200px] bg-muted/20 rounded-b-lg",children:m.length===0?e.jsx("p",{className:"text-center text-muted-foreground text-sm py-8",children:"Aucune tÃ¢che"}):m.map(c=>e.jsx(ss,{draggable:!0,onDragStart:f=>b(f,c.id),className:"cursor-move hover:shadow-md transition-shadow group",children:e.jsx(ts,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Os,{checked:c.isCompleted,onCheckedChange:()=>r(c.id),onClick:f=>f.stopPropagation()}),e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>a(c),children:[e.jsx("p",{className:`text-sm font-medium ${c.isCompleted?"line-through text-muted-foreground":""}`,children:c.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsx(pt,{priority:c.subCategory}),c.estimatedTime&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Fs,{className:"w-3 h-3"}),c.estimatedTime,"min"]}),o&&o(c)]})]}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-destructive hover:text-destructive hover:bg-destructive/10",onClick:f=>N(f,c.id),children:e.jsx(ve,{className:"w-3.5 h-3.5"})})]})})},c.id))})]},x.id)})})},ks=Ee.memo(ft);function Ue(s,l,t){const a=s.slice();return a.splice(t<0?a.length+t:t,0,a.splice(l,1)[0]),a}function jt(s,l){return s.reduce((t,a,r)=>{const i=l.get(a);return i&&(t[r]=i),t},Array(s.length))}function ue(s){return s!==null&&s>=0}function bt(s,l){if(s===l)return!0;if(s.length!==l.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==l[t])return!1;return!0}function vt(s){return typeof s=="boolean"?{draggable:s,droppable:s}:s}const Ts=s=>{let{rects:l,activeIndex:t,overIndex:a,index:r}=s;const i=Ue(l,a,t),o=l[r],g=i[r];return!g||!o?null:{x:g.left-o.left,y:g.top-o.top,scaleX:g.width/o.width,scaleY:g.height/o.height}},me={scaleX:1,scaleY:1},Ct=s=>{var l;let{activeIndex:t,activeNodeRect:a,index:r,rects:i,overIndex:o}=s;const g=(l=i[t])!=null?l:a;if(!g)return null;if(r===t){const j=i[o];return j?{x:0,y:t<o?j.top+j.height-(g.top+g.height):j.top-g.top,...me}:null}const b=Nt(i,r,t);return r>t&&r<=o?{x:0,y:-g.height-b,...me}:r<t&&r>=o?{x:0,y:g.height+b,...me}:{x:0,y:0,...me}};function Nt(s,l,t){const a=s[l],r=s[l-1],i=s[l+1];return a?t<l?r?a.top-(r.top+r.height):i?i.top-(a.top+a.height):0:i?i.top-(a.top+a.height):r?a.top-(r.top+r.height):0:0}const Ss="Sortable",Ds=Ee.createContext({activeIndex:-1,containerId:Ss,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Ts,disabled:{draggable:!1,droppable:!1}});function wt(s){let{children:l,id:t,items:a,strategy:r=Ts,disabled:i=!1}=s;const{active:o,dragOverlay:g,droppableRects:b,over:j,measureDroppableContainers:d}=Ys(),N=Zs(Ss,t),u=g.rect!==null,p=n.useMemo(()=>a.map(S=>typeof S=="object"&&"id"in S?S.id:S),[a]),x=o!=null,m=o?p.indexOf(o.id):-1,c=j?p.indexOf(j.id):-1,f=n.useRef(p),v=!bt(p,f.current),C=c!==-1&&m===-1||v,T=vt(i);bs(()=>{v&&x&&d(p)},[v,p,x,d]),n.useEffect(()=>{f.current=p},[p]);const w=n.useMemo(()=>({activeIndex:m,containerId:N,disabled:T,disableTransforms:C,items:p,overIndex:c,useDragOverlay:u,sortedRects:jt(p,b),strategy:r}),[m,N,T.draggable,T.droppable,C,p,c,b,u,r]);return Ee.createElement(Ds.Provider,{value:w},l)}const yt=s=>{let{id:l,items:t,activeIndex:a,overIndex:r}=s;return Ue(t,a,r).indexOf(l)},kt=s=>{let{containerId:l,isSorting:t,wasDragging:a,index:r,items:i,newIndex:o,previousItems:g,previousContainerId:b,transition:j}=s;return!j||!a||g!==i&&r===o?!1:t?!0:o!==r&&l===b},Tt={duration:200,easing:"ease"},Is="transform",St=ze.Transition.toString({property:Is,duration:0,easing:"linear"}),Dt={roleDescription:"sortable"};function It(s){let{disabled:l,index:t,node:a,rect:r}=s;const[i,o]=n.useState(null),g=n.useRef(t);return bs(()=>{if(!l&&t!==g.current&&a.current){const b=r.current;if(b){const j=tt(a.current,{ignoreTransform:!0}),d={x:b.left-j.left,y:b.top-j.top,scaleX:b.width/j.width,scaleY:b.height/j.height};(d.x||d.y)&&o(d)}}t!==g.current&&(g.current=t)},[l,t,a,r]),n.useEffect(()=>{i&&o(null)},[i]),i}function Pt(s){let{animateLayoutChanges:l=kt,attributes:t,disabled:a,data:r,getNewIndex:i=yt,id:o,strategy:g,resizeObserverConfig:b,transition:j=Tt}=s;const{items:d,containerId:N,activeIndex:u,disabled:p,disableTransforms:x,sortedRects:m,overIndex:c,useDragOverlay:f,strategy:v}=n.useContext(Ds),C=At(a,p),T=d.indexOf(o),w=n.useMemo(()=>({sortable:{containerId:N,index:T,items:d},...r}),[N,r,T,d]),S=n.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:k,node:A,isOver:M,setNodeRef:D}=Js({id:o,data:w,disabled:C.droppable,resizeObserverConfig:{updateMeasurementsFor:S,...b}}),{active:F,activatorEvent:q,activeNodeRect:B,attributes:E,setNodeRef:R,listeners:W,isDragging:Y,over:$,setActivatorNodeRef:Z,transform:G}=Ws({id:o,data:w,attributes:{...Dt,...t},disabled:C.draggable}),le=et(D,R),K=!!F,ee=K&&!x&&ue(u)&&ue(c),se=!f&&Y,te=se&&ee?G:null,oe=ee?te??(g??v)({rects:m,activeNodeRect:B,activeIndex:u,overIndex:c,index:T}):null,H=ue(u)&&ue(c)?i({id:o,items:d,activeIndex:u,overIndex:c}):T,z=F==null?void 0:F.id,O=n.useRef({activeId:z,items:d,newIndex:H,containerId:N}),ae=d!==O.current.items,y=l({active:F,containerId:N,isDragging:Y,isSorting:K,id:o,index:T,items:d,newIndex:O.current.newIndex,previousItems:O.current.items,previousContainerId:O.current.containerId,transition:j,wasDragging:O.current.activeId!=null}),L=It({disabled:!y,index:T,node:A,rect:k});return n.useEffect(()=>{K&&O.current.newIndex!==H&&(O.current.newIndex=H),N!==O.current.containerId&&(O.current.containerId=N),d!==O.current.items&&(O.current.items=d)},[K,H,N,d]),n.useEffect(()=>{if(z===O.current.activeId)return;if(z!=null&&O.current.activeId==null){O.current.activeId=z;return}const h=setTimeout(()=>{O.current.activeId=z},50);return()=>clearTimeout(h)},[z]),{active:F,activeIndex:u,attributes:E,data:w,rect:k,index:T,newIndex:H,items:d,isOver:M,isSorting:K,isDragging:Y,listeners:W,node:A,overIndex:c,over:$,setNodeRef:le,setActivatorNodeRef:Z,setDroppableNodeRef:D,setDraggableNodeRef:R,transform:L??oe,transition:U()};function U(){if(L||ae&&O.current.newIndex===T)return St;if(!(se&&!st(q)||!j)&&(K||y))return ze.Transition.toString({...j,property:Is})}}function At(s,l){var t,a;return typeof s=="boolean"?{draggable:s,droppable:!1}:{draggable:(t=s==null?void 0:s.draggable)!=null?t:l.draggable,droppable:(a=s==null?void 0:s.droppable)!=null?a:l.droppable}}function be(s){if(!s)return!1;const l=s.data.current;return!!(l&&"sortable"in l&&typeof l.sortable=="object"&&"containerId"in l.sortable&&"items"in l.sortable&&"index"in l.sortable)}const Mt=[J.Down,J.Right,J.Up,J.Left],Rt=(s,l)=>{let{context:{active:t,collisionRect:a,droppableRects:r,droppableContainers:i,over:o,scrollableAncestors:g}}=l;if(Mt.includes(s.code)){if(s.preventDefault(),!t||!a)return;const b=[];i.getEnabled().forEach(N=>{if(!N||N!=null&&N.disabled)return;const u=r.get(N.id);if(u)switch(s.code){case J.Down:a.top<u.top&&b.push(N);break;case J.Up:a.top>u.top&&b.push(N);break;case J.Left:a.left>u.left&&b.push(N);break;case J.Right:a.left<u.left&&b.push(N);break}});const j=Gs({collisionRect:a,droppableRects:r,droppableContainers:b});let d=Hs(j,"id");if(d===(o==null?void 0:o.id)&&j.length>1&&(d=j[1].id),d!=null){const N=i.get(t.id),u=i.get(d),p=u?r.get(u.id):null,x=u==null?void 0:u.node.current;if(x&&p&&N&&u){const c=Qs(x).some((S,k)=>g[k]!==S),f=Ps(N,u),v=Ot(N,u),C=c||!f?{x:0,y:0}:{x:v?a.width-p.width:0,y:v?a.height-p.height:0},T={x:p.left,y:p.top};return C.x&&C.y?T:Xs(T,C)}}}};function Ps(s,l){return!be(s)||!be(l)?!1:s.data.current.sortable.containerId===l.data.current.sortable.containerId}function Ot(s,l){return!be(s)||!be(l)||!Ps(s,l)?!1:s.data.current.sortable.index<l.data.current.sortable.index}const Qe=["bg-muted","bg-project/10","bg-green-50 dark:bg-green-900/20","bg-blue-50 dark:bg-blue-900/20","bg-orange-50 dark:bg-orange-900/20","bg-purple-50 dark:bg-purple-900/20"],Ft=({column:s,onRename:l,onRemove:t,disabled:a})=>{const{attributes:r,listeners:i,setNodeRef:o,transform:g,transition:b,isDragging:j}=Pt({id:s.id}),d={transform:ze.Transform.toString(g),transition:b,opacity:j?.5:1};return e.jsxs("div",{ref:o,style:d,className:"flex items-center gap-2 p-2 rounded-lg border bg-card",children:[e.jsx("div",{...r,...i,className:"cursor-grab active:cursor-grabbing",children:e.jsx(it,{className:"w-4 h-4 text-muted-foreground"})}),e.jsx("div",{className:`w-4 h-4 rounded ${s.color}`}),e.jsx(re,{value:s.name,onChange:N=>l(N.target.value),className:"flex-1 h-8"}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:t,disabled:a,children:e.jsx(ve,{className:"w-4 h-4"})})]})},As=({columns:s,onColumnsChange:l,isOpen:t,onClose:a})=>{const[r,i]=n.useState(s),[o,g]=n.useState(!1);n.useEffect(()=>{i(s)},[s]);const[b,j]=n.useState(""),d=at(Ve(nt),Ve(rt,{coordinateGetter:Rt})),N=f=>{const{active:v,over:C}=f;if(C&&v.id!==C.id){const T=r.findIndex(S=>S.id===v.id),w=r.findIndex(S=>S.id===C.id);i(Ue(r,T,w))}},u=()=>{if(!b.trim()||r.length>=6)return;const f={id:`custom-${Date.now()}`,name:b.trim(),color:Qe[r.length%Qe.length],order:r.length};i([...r,f]),j("")},p=f=>{r.length<=2||i(r.filter(v=>v.id!==f))},x=(f,v)=>{i(r.map(C=>C.id===f?{...C,name:v}:C))},m=async()=>{g(!0);try{const f=r.map((v,C)=>({...v,order:C}));await l(f),a()}finally{g(!1)}},c=()=>{i(Ce)};return e.jsx(Ye,{open:t,onOpenChange:a,children:e.jsxs(Ze,{className:"sm:max-w-[500px]",children:[e.jsxs(Je,{children:[e.jsx(We,{children:"GÃ©rer les colonnes Kanban"}),e.jsx(Ls,{children:"Personnalisez les colonnes de votre tableau Kanban. Maximum 6 colonnes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx(lt,{sensors:d,collisionDetection:ot,onDragEnd:N,children:e.jsx(wt,{items:r.map(f=>f.id),strategy:Ct,children:e.jsx("div",{className:"space-y-2",children:r.map(f=>e.jsx(Ft,{column:f,onRename:v=>x(f.id,v),onRemove:()=>p(f.id),disabled:r.length<=2},f.id))})})}),r.length<6&&e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(X,{htmlFor:"new-column",children:"Nouvelle colonne"}),e.jsx(re,{id:"new-column",value:b,onChange:f=>j(f.target.value),placeholder:"Nom de la colonne",onKeyDown:f=>f.key==="Enter"&&u()})]}),e.jsxs(P,{onClick:u,disabled:!b.trim(),children:[e.jsx(as,{className:"w-4 h-4 mr-1"}),"Ajouter"]})]})]}),e.jsxs(Es,{className:"flex justify-between",children:[e.jsx(P,{variant:"outline",onClick:c,children:"RÃ©initialiser"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",onClick:a,children:"Annuler"}),e.jsx(P,{onClick:m,disabled:o,children:o?"Enregistrement...":"Enregistrer"})]})]})]})})},Lt=({project:s,onBack:l,onEdit:t,onDelete:a})=>{var ae;const{getTasksByColumns:r,updateTaskStatus:i,reloadTasks:o}=gt(s.id),{addTask:g,updateTask:b,removeTask:j}=_s(),{deleteProject:d,completeProject:N,updateProject:u,projects:p}=Xe(),{toast:x}=rs(),[m,c]=n.useState(!1),[f,v]=n.useState(null),[C,T]=n.useState(!1),w=n.useMemo(()=>p.find(y=>y.id===s.id)??s,[p,s]),S=n.useMemo(()=>w.kanbanColumns||Ce,[w.kanbanColumns]),k=ne[w.status],A=n.useMemo(()=>Object.values(r(S)).flat(),[S,r]),{searchQuery:M,setSearchQuery:D,sortBy:F,setSortBy:q,priorityFilter:B,setPriorityFilter:E,hasActiveFilters:R,clearFilters:W,filterAndSortTasks:Y}=ws({tasks:A,getTaskName:y=>y.name,getSubCategory:y=>y.subCategory,getEstimatedTime:y=>y.estimatedTime||0}),$=n.useMemo(()=>{const y=r(S),L={};return Object.entries(y).forEach(([U,h])=>{L[U]=Y(h)}),L},[S,r,Y]),Z=n.useMemo(()=>{var I;const L=Object.values($).flat().length,U=((I=$.done)==null?void 0:I.length)||0,h=L>0?Math.round(U/L*100):0;return{total:L,done:U,progress:h}},[$]),G=n.useCallback(async()=>{window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le projet "${w.name}" ? Cette action est irrÃ©versible.`)&&await d(w.id)&&a&&a()},[w.id,w.name,d,a]),le=n.useCallback(async()=>{window.confirm(`Marquer le projet "${w.name}" comme terminÃ© ?`)&&await N(w.id)&&a&&a()},[w.id,w.name,N,a]),K=n.useCallback(async()=>{const y=w.showInSidebar??!1;await u(w.id,{showInSidebar:!y}),x({title:y?"MasquÃ© de la sidebar":"AffichÃ© dans la sidebar",description:y?"Les tÃ¢ches de ce projet ne s'affichent plus dans la sidebar":"Les tÃ¢ches de ce projet apparaissent maintenant dans la sidebar"})},[w,u,x]),ee=n.useCallback(async y=>{await u(w.id,{kanbanColumns:y})&&(o(),x({title:"Colonnes mises Ã  jour",description:"La configuration du tableau Kanban a Ã©tÃ© sauvegardÃ©e."}))},[w.id,u,o,x]),se=n.useCallback(y=>{v(y),c(!0)},[]),te=n.useCallback(async y=>{const U=Object.values($).flat().find(h=>h.id===y);if(U){const h=U.isCompleted?"todo":"done";await i(y,h)}},[$,i]),de=n.useCallback(async y=>{await j(y),o(),x({title:"TÃ¢che supprimÃ©e",description:"La tÃ¢che a Ã©tÃ© supprimÃ©e avec succÃ¨s."})},[j,o,x]),oe=n.useCallback(()=>{v(null),c(!0)},[]),H=n.useCallback(()=>{c(!1),v(null),o()},[o]),z=n.useCallback(async y=>{await g(y),o()},[g,o]),O=n.useCallback(async(y,L)=>{await b(y,L),o()},[b,o]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(P,{variant:"ghost",size:"icon",onClick:l,children:e.jsx(ns,{className:"w-5 h-5"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:w.icon||"ðŸ“š"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:w.name}),e.jsx(_,{className:`${k.bgColor} ${k.color} mt-1`,children:k.label})]})]}),w.description&&e.jsx("p",{className:"text-muted-foreground max-w-2xl",children:w.description})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-card",children:[e.jsx(ls,{id:"show-in-sidebar",checked:w.showInSidebar??!1,onCheckedChange:K}),e.jsx(X,{htmlFor:"show-in-sidebar",className:"text-sm cursor-pointer flex items-center gap-1",children:w.showInSidebar?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-4 h-4 text-project"})," Sidebar"]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-4 h-4 text-muted-foreground"})," Sidebar"]})})]}),e.jsx(P,{variant:"outline",size:"sm",className:"h-auto py-2",onClick:()=>T(!0),children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsxs(P,{variant:"outline",onClick:t,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Modifier"]}),w.status!=="completed"&&e.jsxs(P,{variant:"outline",onClick:le,className:"text-green-600 border-green-600 hover:bg-green-50 hover:text-green-700",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Terminer"]}),e.jsxs(P,{variant:"destructive",onClick:G,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Supprimer"]}),e.jsxs(P,{onClick:oe,className:"bg-project hover:bg-project/90 text-white",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Ajouter au projet"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progression"}),e.jsxs("p",{className:"text-2xl font-bold",children:[Z.progress,"%"]})]}),e.jsx(us,{className:"w-8 h-8 text-project"})]}),e.jsx(_e,{value:Z.progress,className:"mt-2"})]}),w.targetDate&&e.jsx("div",{className:"bg-card p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date cible"}),e.jsx("p",{className:"text-lg font-semibold",children:new Date(w.targetDate).toLocaleDateString("fr-FR",{day:"numeric",month:"long"})})]}),e.jsx(Be,{className:"w-8 h-8 text-blue-500"})]})}),e.jsx("div",{className:"bg-card p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"TÃ¢ches totales"}),e.jsx("p",{className:"text-2xl font-bold",children:Z.total})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Z.done," terminÃ©es"]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(re,{type:"text",placeholder:"Rechercher une tÃ¢che...",value:M,onChange:y=>D(y.target.value),className:"pl-10 bg-background"})]}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(P,{variant:B!=="all"?"default":"outline",className:"gap-2",children:[e.jsx(hs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:B==="all"?"PrioritÃ©":B})]})}),e.jsxs(ge,{align:"end",className:"w-56",children:[e.jsx(pe,{children:"Filtrer par prioritÃ©"}),e.jsx(fe,{}),ys.map(y=>e.jsx(je,{onClick:()=>E(y.value),className:B===y.value?"bg-accent":"",children:y.label},y.value))]})]}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(P,{variant:F!=="none"?"default":"outline",className:"gap-2",children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Trier"})]})}),e.jsxs(ge,{align:"end",className:"w-56",children:[e.jsx(pe,{children:"Trier les tÃ¢ches"}),e.jsx(fe,{}),Oe.map(y=>e.jsx(je,{onClick:()=>q(y.value),className:F===y.value?"bg-accent":"",children:y.label},y.value))]})]}),R&&e.jsx(P,{variant:"ghost",size:"icon",onClick:W,children:e.jsx(gs,{className:"w-4 h-4"})})]}),R&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Filtres actifs :"}),M&&e.jsxs(_,{variant:"secondary",className:"gap-1",children:['Recherche: "',M,'"']}),B!=="all"&&e.jsx(_,{variant:"secondary",className:"gap-1",children:B}),F!=="none"&&e.jsxs(_,{variant:"secondary",className:"gap-1",children:["Tri: ",(ae=Oe.find(y=>y.value===F))==null?void 0:ae.label]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Tableau Kanban"}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>T(!0),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Colonnes"]})]}),e.jsx(ks,{tasksByColumn:$,columns:S,onStatusChange:i,onTaskClick:se,onToggleComplete:te,onDeleteTask:de})]}),e.jsx(As,{columns:S,onColumnsChange:ee,isOpen:C,onClose:()=>T(!1)}),m&&e.jsx(ps,{isOpen:m,onClose:H,editingTask:f||void 0,projectId:w.id,taskType:"project",onAddTask:z,onUpdateTask:O})]})},Et=["todo","in-progress","done"],_t=(s,l)=>{const{tasks:t,loading:a,updateTask:r,toggleComplete:i,refreshTasks:o}=fs(s),g=n.useMemo(()=>l?t.filter(u=>u.project_id===l):[],[t,l]),b=n.useCallback(u=>u.projectStatus?u.projectStatus:u.isCompleted?"done":"todo",[]),j=n.useCallback(u=>{const p=(u==null?void 0:u.map(m=>m.id))||Et,x={};return p.forEach(m=>{x[m]=[]}),g.forEach(m=>{var f,v;const c=b(m);if(x[c])x[c].push(m);else if(c==="done"){const C=p[p.length-1];(f=x[C])==null||f.push(m)}else{const C=p[0]||"todo";(v=x[C])==null||v.push(m)}}),x},[g,b]),d=n.useCallback(async(u,p)=>{const x=p==="done";try{const{error:m}=await Bs.from("team_tasks").update({project_status:p,iscompleted:x,...x?{lastcompletedat:new Date().toISOString()}:{}}).eq("id",u);if(m)throw m;return o(),!0}catch{return!1}},[o]),N=n.useMemo(()=>({todo:g.filter(u=>!u.isCompleted),inProgress:[],done:g.filter(u=>u.isCompleted)}),[g]);return{tasks:g,loading:a,getTasksByColumns:j,updateTaskStatus:d,tasksByStatus:N,reloadTasks:o}},Ie=s=>{var l;return((l=s.profiles)==null?void 0:l.display_name)||"Membre"},Bt=({project:s,teamId:l,teamMembers:t,onBack:a,onEdit:r,onDelete:i})=>{var U;const{tasks:o,getTasksByColumns:g,updateTaskStatus:b,reloadTasks:j}=_t(l,s.id),{createTask:d,deleteTask:N,toggleComplete:u,updateTask:p}=fs(l),{projects:x,updateProject:m}=js(l),{toast:c}=rs(),[f,v]=n.useState(!1),[C,T]=n.useState(null),[w,S]=n.useState(!1),k=n.useMemo(()=>x.find(h=>h.id===s.id)??s,[x,s]),A=n.useMemo(()=>k.kanbanColumns||Ce,[k.kanbanColumns]),M=ne[k.status]||ne.planning,{searchQuery:D,setSearchQuery:F,sortBy:q,setSortBy:B,priorityFilter:E,setPriorityFilter:R,hasActiveFilters:W,clearFilters:Y,filterAndSortTasks:$}=ws({tasks:o,getTaskName:h=>h.name,getSubCategory:h=>h.subCategory,getEstimatedTime:h=>h.estimatedTime||0,getAssignedTo:h=>h.assigned_to}),Z=n.useMemo(()=>{const h=g(A),I={};return Object.entries(h).forEach(([V,Q])=>{I[V]=$(Q)}),I},[A,g,$]),G=n.useMemo(()=>{const h=o.length,I=o.filter(ie=>ie.isCompleted).length,V=h>0?Math.round(I/h*100):0,Q=o.filter(ie=>ie.assigned_to).length;return{total:h,done:I,progress:V,assigned:Q}},[o]),le=n.useCallback(async()=>{window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer le projet "${k.name}" ?`)&&i&&i()},[k.name,i]),K=n.useCallback(async()=>{window.confirm(`Marquer le projet "${k.name}" comme terminÃ© ?`)&&await m(k.id,{status:"completed"})&&(c({title:"Projet terminÃ©",description:`Le projet "${k.name}" a Ã©tÃ© marquÃ© comme terminÃ©.`}),i&&i())},[k.id,k.name,m,c,i]),ee=n.useCallback(async()=>{const h=!k.showInSidebar;await m(k.id,{showInSidebar:h})&&c({title:h?"AffichÃ© dans la sidebar":"MasquÃ© de la sidebar",description:h?"Les tÃ¢ches de ce projet apparaissent dans la sidebar":"Les tÃ¢ches de ce projet sont masquÃ©es de la sidebar"})},[k,m,c]),se=n.useCallback(async h=>{await m(k.id,{kanbanColumns:h})&&(j(),c({title:"Colonnes mises Ã  jour",description:"La configuration du tableau Kanban a Ã©tÃ© sauvegardÃ©e."}))},[k.id,m,j,c]),te=n.useCallback(h=>{const I=o.find(V=>V.id===h.id);I&&(T(I),v(!0))},[o]),de=n.useCallback(async h=>{const I=o.find(V=>V.id===h);I&&await u(h,!I.isCompleted)},[o,u]),oe=n.useCallback(async h=>{await N(h),c({title:"TÃ¢che supprimÃ©e",description:"La tÃ¢che a Ã©tÃ© supprimÃ©e avec succÃ¨s."})},[N,c]),H=n.useCallback(()=>{T(null),v(!0)},[]),z=n.useCallback(()=>{v(!1),T(null),j()},[j]),O=n.useCallback(async h=>{await d({...h,project_id:k.id}),j()},[d,k.id,j]),ae=n.useCallback(async(h,I)=>{await p(h,I),j()},[p,j]),y=n.useCallback(h=>{if(!h)return"?";const I=t.find(Q=>Q.user_id===h);return I?Ie(I).split(" ").map(Q=>Q[0]).join("").toUpperCase().slice(0,2):"?"},[t]),L=n.useCallback(h=>{const I=h;if(!I.assigned_to)return null;const V=t.find(ie=>ie.user_id===I.assigned_to),Q=V?Ie(V):"AssignÃ©";return e.jsx(qe,{className:"h-5 w-5",title:Q,children:e.jsx($e,{className:"text-[10px] bg-primary/20 text-primary",children:y(I.assigned_to)})})},[t,y]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(P,{variant:"ghost",size:"icon",onClick:a,children:e.jsx(ns,{className:"w-5 h-5"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:k.icon||"ðŸ“"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:k.name}),e.jsxs(_,{variant:"outline",className:"gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Ã‰quipe"]})]}),e.jsx(_,{className:`${M.bgColor} ${M.color} mt-1`,children:M.label})]})]}),k.description&&e.jsx("p",{className:"text-muted-foreground max-w-2xl",children:k.description})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md border bg-card",children:[e.jsx(ls,{id:"show-in-sidebar",checked:k.showInSidebar??!1,onCheckedChange:ee}),e.jsx(X,{htmlFor:"show-in-sidebar",className:"text-sm cursor-pointer flex items-center gap-1",children:k.showInSidebar?e.jsxs(e.Fragment,{children:[e.jsx(os,{className:"w-4 h-4 text-project"})," Sidebar"]}):e.jsxs(e.Fragment,{children:[e.jsx(is,{className:"w-4 h-4 text-muted-foreground"})," Sidebar"]})})]}),e.jsx(P,{variant:"outline",size:"sm",className:"h-auto py-2",onClick:()=>S(!0),children:e.jsx(Me,{className:"w-4 h-4"})}),e.jsxs(P,{variant:"outline",onClick:r,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Modifier"]}),k.status!=="completed"&&e.jsxs(P,{variant:"outline",onClick:K,className:"text-green-600 border-green-600 hover:bg-green-50 hover:text-green-700",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Terminer"]}),e.jsxs(P,{variant:"destructive",onClick:le,children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Supprimer"]}),e.jsxs(P,{onClick:H,className:"bg-project hover:bg-project/90 text-white",children:[e.jsx(Cs,{className:"w-4 h-4 mr-2"}),"Ajouter au projet"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-card p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progression"}),e.jsxs("p",{className:"text-2xl font-bold",children:[G.progress,"%"]})]}),e.jsx(us,{className:"w-8 h-8 text-project"})]}),e.jsx(_e,{value:G.progress,className:"mt-2"})]}),e.jsx("div",{className:"bg-card p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"TÃ¢ches"}),e.jsx("p",{className:"text-2xl font-bold",children:G.total})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[G.done," terminÃ©es"]})]})}),e.jsx("div",{className:"bg-card p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"AssignÃ©es"}),e.jsx("p",{className:"text-2xl font-bold",children:G.assigned})]}),e.jsx(zs,{className:"w-8 h-8 text-blue-500"})]})}),k.targetDate&&e.jsx("div",{className:"bg-card p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date cible"}),e.jsx("p",{className:"text-lg font-semibold",children:new Date(k.targetDate).toLocaleDateString("fr-FR",{day:"numeric",month:"long"})})]}),e.jsx(Be,{className:"w-8 h-8 text-blue-500"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 p-4 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(re,{type:"text",placeholder:"Rechercher une tÃ¢che...",value:D,onChange:h=>F(h.target.value),className:"pl-10 bg-background"})]}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(P,{variant:E!=="all"?"default":"outline",className:"gap-2",children:[e.jsx(hs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:E==="all"?"PrioritÃ©":E})]})}),e.jsxs(ge,{align:"end",className:"w-56",children:[e.jsx(pe,{children:"Filtrer par prioritÃ©"}),e.jsx(fe,{}),ys.map(h=>e.jsx(je,{onClick:()=>R(h.value),className:E===h.value?"bg-accent":"",children:h.label},h.value))]})]}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(P,{variant:q!=="none"?"default":"outline",className:"gap-2",children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Trier"})]})}),e.jsxs(ge,{align:"end",className:"w-56",children:[e.jsx(pe,{children:"Trier les tÃ¢ches"}),e.jsx(fe,{}),He.map(h=>e.jsx(je,{onClick:()=>B(h.value),className:q===h.value?"bg-accent":"",children:h.label},h.value))]})]}),W&&e.jsx(P,{variant:"ghost",size:"icon",onClick:Y,children:e.jsx(gs,{className:"w-4 h-4"})})]}),W&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Filtres actifs :"}),D&&e.jsxs(_,{variant:"secondary",className:"gap-1",children:['Recherche: "',D,'"']}),E!=="all"&&e.jsx(_,{variant:"secondary",className:"gap-1",children:E}),q!=="none"&&e.jsxs(_,{variant:"secondary",className:"gap-1",children:["Tri: ",(U=He.find(h=>h.value===q))==null?void 0:U.label]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Tableau Kanban"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.length," membre",t.length>1?"s":""]}),e.jsxs("div",{className:"flex -space-x-2",children:[t.slice(0,5).map(h=>e.jsx(qe,{className:"h-6 w-6 border-2 border-background",children:e.jsx($e,{className:"text-xs",children:Ie(h).split(" ").map(I=>I[0]).join("").toUpperCase().slice(0,2)})},h.id)),t.length>5&&e.jsxs("div",{className:"h-6 w-6 rounded-full bg-muted flex items-center justify-center text-xs border-2 border-background",children:["+",t.length-5]})]})]})]}),e.jsx(ks,{tasksByColumn:Z,columns:A,onStatusChange:b,onTaskClick:te,onToggleComplete:de,onDeleteTask:oe,renderTaskBadge:L})]}),e.jsx(ps,{isOpen:f,onClose:z,editingTask:C?{...C,user_id:""}:void 0,onAddTask:async h=>{await O(h),z()},onUpdateTask:async(h,I)=>{await ae(h,I),z()},projectId:k.id,taskType:"team",teamMembers:t.map(h=>{var I;return{user_id:h.user_id,display_name:((I=h.profiles)==null?void 0:I.display_name)||void 0}})}),e.jsx(As,{columns:A,onColumnsChange:se,isOpen:w,onClose:()=>S(!1)})]})},zt=({project:s,isTeamMode:l,teamId:t,teamMembers:a,showModal:r,selectedProject:i,onBack:o,onEdit:g,onDelete:b,onModalClose:j,onModalSave:d})=>l&&t?e.jsxs(e.Fragment,{children:[e.jsx(Bt,{project:{id:s.id,name:s.name,description:s.description,icon:s.icon,color:s.color,status:s.status,targetDate:s.targetDate,progress:s.progress,createdAt:s.createdAt,updatedAt:s.updatedAt,completedAt:s.completedAt,orderIndex:s.orderIndex,teamId:t,createdBy:s.createdBy||"",kanbanColumns:s.kanbanColumns,showInSidebar:s.showInSidebar??!1},teamId:t,teamMembers:a,onBack:o,onEdit:g,onDelete:b}),e.jsx(Re,{open:r,onClose:j,onSave:d,project:i,teamId:t})]}):e.jsxs(e.Fragment,{children:[e.jsx(Lt,{project:s,onBack:o,onEdit:g,onDelete:b}),e.jsx(Re,{open:r,onClose:j,onSave:d,project:i,teamId:t??void 0})]}),Ut=s=>{const{items:l}=es({contextTypes:["project_task"]});return n.useMemo(()=>{const a=l.filter(o=>o.parentId===s),r=a.length;if(r===0)return 0;const i=a.filter(o=>o.isCompleted).length;return Math.round(i/r*100)},[l,s])},qt=({project:s,onClick:l,taskCount:t,overrideProgress:a})=>{const r=ne[s.status]||ne.planning,i=mt(s),o=Ut(i?null:s.id),g=a??(i?s.progress:o);return e.jsxs(ss,{className:"cursor-pointer hover:shadow-lg transition-all",onClick:l,style:{borderLeftColor:s.color,borderLeftWidth:"4px"},children:[e.jsx(Us,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("span",{className:"text-2xl",children:s.icon||"ðŸ“š"}),e.jsx(qs,{className:"text-lg",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&e.jsxs(_,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Ã‰quipe"]}),e.jsx(_,{className:r.bgColor+" "+r.color,children:r.label})]})]})}),e.jsxs(ts,{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"font-medium",children:[g,"%"]})]}),e.jsx(_e,{value:g,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[s.targetDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:new Date(s.targetDate).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]}),t!==void 0&&e.jsxs("span",{children:[t," tÃ¢ches"]})]})]})]})},$t=({onClick:s})=>e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 flex flex-col items-center justify-center gap-3\r
      transition-all duration-200 min-h-[200px]\r
      border-border bg-card hover:border-muted-foreground/50 cursor-pointer`,onClick:s,children:[e.jsx(vs,{className:"w-10 h-10 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Nouveau projet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cliquez pour crÃ©er un projet"})]})]}),Pe=({projects:s,onProjectClick:l,showNewProjectZone:t=!1,onNewProjectClick:a})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.map(r=>e.jsx(qt,{project:r,onClick:()=>l(r)},r.id)),t&&a&&e.jsx($t,{onClick:a})]}),Qt=()=>{const{projects:s,loading:l,isTeamMode:t,teamName:a,teamId:r,createProject:i,updateProject:o,deleteProject:g,getActiveProjects:b,getCompletedProjects:j,getArchivedProjects:d}=ht(),{teamMembers:N}=Le(),[u,p]=n.useState(!1),[x,m]=n.useState(null),[c,f]=n.useState(null),v=n.useMemo(()=>x?s.find(R=>R.id===x)??null:null,[s,x]),C=n.useMemo(()=>c?s.find(R=>R.id===c)??null:null,[s,c]),T=async R=>{await i(R.name,R.description,R.icon,R.color),p(!1)},w=async R=>{v&&(await o(v.id,R),p(!1),m(null))},S=R=>{f(R.id)},k=()=>{C&&(m(C.id),p(!0))},A=async()=>{C&&(await g(C.id),f(null))},M=()=>{p(!1),m(null)},D=t?`Projets de ${a}`:"Projets",F=t?"GÃ©rez les projets de votre Ã©quipe":"GÃ©rez vos projets complexes avec des tÃ¢ches organisÃ©es",q=b(),B=j(),E=d();return C?e.jsx(zt,{project:C,isTeamMode:t,teamId:r,teamMembers:N,showModal:u,selectedProject:v,onBack:()=>f(null),onEdit:k,onDelete:A,onModalClose:M,onModalSave:w}):e.jsxs(ct,{header:{title:D,subtitle:F,icon:t?e.jsx(ce,{className:"w-5 h-5"}):e.jsx(Ks,{className:"w-5 h-5"}),actions:e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsxs(_,{variant:"secondary",className:"gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Ã‰quipe"]}),e.jsxs(P,{onClick:()=>p(!0),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),t?"Nouveau projet d'Ã©quipe":"Nouveau projet"]})]})},state:l?"loading":s.length===0?"empty":"success",loadingProps:{variant:"cards"},emptyProps:{title:t?"Aucun projet d'Ã©quipe":"Aucun projet",description:t?"CrÃ©ez le premier projet pour votre Ã©quipe":"CrÃ©ez votre premier projet pour organiser vos tÃ¢ches",icon:e.jsx(vs,{className:"w-12 h-12"}),action:{label:t?"CrÃ©er un projet d'Ã©quipe":"CrÃ©er un projet",onClick:()=>p(!0)}},children:[e.jsxs($s,{defaultValue:"active",className:"w-full",children:[e.jsxs(Vs,{children:[e.jsxs(Se,{value:"active",children:["Actifs (",q.length,")"]}),e.jsxs(Se,{value:"completed",children:["TerminÃ©s (",B.length,")"]}),E.length>0&&e.jsxs(Se,{value:"archived",children:["ArchivÃ©s (",E.length,")"]})]}),e.jsx(De,{value:"active",className:"mt-6",children:e.jsx(Pe,{projects:q,onProjectClick:S,showNewProjectZone:!0,onNewProjectClick:()=>p(!0)})}),e.jsx(De,{value:"completed",className:"mt-6",children:e.jsx(Pe,{projects:B,onProjectClick:S})}),E.length>0&&e.jsx(De,{value:"archived",className:"mt-6",children:e.jsx(Pe,{projects:E,onProjectClick:S})})]}),e.jsx(Re,{open:u,onClose:M,onSave:v?w:T,project:v,teamId:r??void 0})]})};export{Qt as default};
