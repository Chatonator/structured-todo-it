import{aJ as S,f as B,a_ as E,aS as F,r as v,j as e,aw as c,C as l,d as n,ay as b,az as G,L as w,N as U,bq as $,a as H,b as J,br as K,c as N,b1 as O,Y,a$ as Z,b0 as Q,a3 as W,a4 as X,a6 as ee,a7 as g,bs as y,aZ as se,bt as te,B as ae,v as re}from"./index-DkVHath_.js";import{u as ie}from"./useTeamProjects-dCfehhvX.js";import{V as C}from"./ViewLayout-ya6HA0TA.js";import{A as k}from"./arrow-right-DpnBJ8fy.js";import{E as le}from"./ellipsis-vertical-Bc4UBk8X.js";const ne=t=>{var s;return((s=t.profiles)==null?void 0:s.display_name)||"Membre"},oe=({role:t})=>{const s={owner:{label:"Propriétaire",icon:te,className:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200"},admin:{label:"Admin",icon:y,className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200"},member:{label:"Membre",icon:c,className:"bg-muted text-muted-foreground"}}[t],a=s.icon;return e.jsxs(ae,{variant:"outline",className:re("gap-1 text-xs",s.className),children:[e.jsx(a,{className:"w-3 h-3"}),s.label]})},je=({className:t})=>{const{currentTeam:s,teamMembers:a,updateMemberRole:p,removeMember:m}=S(),{setCurrentView:x,setIsModalOpen:j}=B(),{tasks:u,loading:T}=E((s==null?void 0:s.id)??null),{projects:h,loading:M}=ie((s==null?void 0:s.id)??null),{toast:P}=F(),[R,f]=v.useState(!1),r=v.useMemo(()=>{const i=u.filter(o=>o.isCompleted).length,d=u.length,A=d>0?Math.round(i/d*100):0,I=h.filter(o=>o.status!=="archived"&&o.status!=="completed").length,V=h.filter(o=>o.status==="completed").length;return{totalTasks:d,completedTasks:i,completionRate:A,activeProjects:I,completedProjects:V,totalProjects:h.length}},[u,h]),D=()=>{s!=null&&s.invite_code&&(navigator.clipboard.writeText(s.invite_code),f(!0),P({title:"Code copié !",description:"Le code d'invitation a été copié dans le presse-papier."}),setTimeout(()=>f(!1),2e3))},q=()=>{x("tasks")},L=()=>{x("projects")},_=()=>{j(!0)};if(!s)return e.jsx(C,{header:{title:"Équipe",subtitle:"Gérez votre équipe",icon:e.jsx(c,{className:"w-5 h-5"})},state:"empty",emptyProps:{title:"Aucune équipe sélectionnée",description:"Sélectionnez une équipe depuis le sélecteur de contexte pour voir son tableau de bord.",icon:e.jsx(c,{className:"w-12 h-12"})},className:t,children:e.jsx("div",{})});const z=T||M;return e.jsx(C,{header:{title:s.name,subtitle:`${a.length} membre${a.length>1?"s":""} • Tableau de bord`,icon:e.jsx(c,{className:"w-5 h-5"}),actions:e.jsxs(N,{onClick:_,size:"sm",className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Nouvelle tâche"]})},state:z?"loading":"success",loadingProps:{variant:"list"},className:t,children:e.jsxs("div",{className:"space-y-6 pb-20 md:pb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(l,{children:e.jsxs(n,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Tâches"}),e.jsxs("p",{className:"text-2xl font-bold",children:[r.completedTasks,"/",r.totalTasks]})]}),e.jsx(b,{className:"w-8 h-8 text-primary/20"})]}),e.jsx(G,{value:r.completionRate,className:"mt-2 h-1"})]})}),e.jsx(l,{children:e.jsxs(n,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Projets actifs"}),e.jsx("p",{className:"text-2xl font-bold",children:r.activeProjects})]}),e.jsx(w,{className:"w-8 h-8 text-project/20"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[r.completedProjects," terminés"]})]})}),e.jsx(l,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Membres"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsx(c,{className:"w-8 h-8 text-muted-foreground/30"})]})})}),e.jsx(l,{className:"cursor-pointer hover:bg-muted/50 transition-colors",onClick:D,children:e.jsxs(n,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Code d'invitation"}),e.jsx("p",{className:"text-lg font-mono font-bold truncate max-w-[120px]",children:s.invite_code})]}),R?e.jsx(U,{className:"w-6 h-6 text-primary"}):e.jsx($,{className:"w-6 h-6 text-muted-foreground/50"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Cliquez pour copier"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(l,{className:"cursor-pointer hover:shadow-md transition-shadow group",onClick:q,children:e.jsxs(n,{className:"pt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10",children:e.jsx(b,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Voir les tâches"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.totalTasks-r.completedTasks," tâches en attente"]})]})]}),e.jsx(k,{className:"w-5 h-5 text-muted-foreground group-hover:translate-x-1 transition-transform"})]})}),e.jsx(l,{className:"cursor-pointer hover:shadow-md transition-shadow group",onClick:L,children:e.jsxs(n,{className:"pt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-accent",children:e.jsx(w,{className:"w-6 h-6 text-accent-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Voir les projets"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.activeProjects," projets actifs"]})]})]}),e.jsx(k,{className:"w-5 h-5 text-muted-foreground group-hover:translate-x-1 transition-transform"})]})})]}),e.jsxs(l,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(J,{className:"text-lg",children:"Membres de l'équipe"}),e.jsxs(K,{children:[a.length," membre",a.length>1?"s":""]})]}),e.jsxs(N,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Inviter"]})]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:a.map(i=>e.jsx(ce,{member:i,currentTeamId:s.id,onUpdateRole:d=>p(s.id,i.user_id,d),onRemove:()=>m(s.id,i.user_id)},i.id))})})]})]})})},ce=({member:t,currentTeamId:s,onUpdateRole:a,onRemove:p})=>{const m=ne(t),x=m.split(" ").map(j=>j[0]).join("").toUpperCase().slice(0,2);return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-10 h-10",children:e.jsx(Q,{className:"bg-primary/10 text-primary font-medium",children:x})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Rejoint le ",new Date(t.joined_at).toLocaleDateString("fr-FR")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{role:t.role}),t.role!=="owner"&&e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(le,{className:"w-4 h-4"})})}),e.jsxs(ee,{align:"end",children:[t.role!=="admin"&&e.jsxs(g,{onClick:()=>a("admin"),children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Promouvoir admin"]}),t.role==="admin"&&e.jsxs(g,{onClick:()=>a("member"),children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Rétrograder en membre"]}),e.jsx(se,{}),e.jsx(g,{onClick:p,className:"text-destructive focus:text-destructive",children:"Retirer de l'équipe"})]})]})]})]})};export{je as default};
